---
title: 12장 병렬성과 비동기성
date: 2022-06-20 23:17:33 +0900
categories: [BOOK, 한 권으로 읽는 컴퓨터 구조와 프로그래밍]
tags: [computer]  # TAG는 반드시 소문자로 이루어져야함!
---

## 경합 조건이란 무엇인가
경합 조건은 2개의 프로그램이 같은 자원에 동시에 접근하고, 자원 사용 순서에 따라 결과가 달라지는 경우를 뜻한다. 예를 들어 은행 계좌에 돈을 입금하는 경우 공유자원은 계좌 잔고다.

## 공유 자원
메모리는 항상 공유 문제와 연관된다. 공유 대상이 메모리가 아닌 경우에도 메모리가 관련된 경우가 많다.

I/O 장치를 서로 공유하는 경우는 흔하다. 한 예로 프린터기기가 있다. 그리고 FPGA가 새로운 공유 대상 자원으로 떠오르고 있다.

## 프로세스와 스레드
운영체제는 프로세스를 관리하고, 프로세스는 사용자 공간에서 실행되는 프로그램이다. 멀티 코어 시스템에서는 여러 프로그램이 병렬로 실행될 수 있다. 자원을 공유하는 프로세스들은 어떤 방식으로든 서로 통신을 해야 한다.

때로 프로세스가 여러 가지 일에 신경써야 할 수도 있다. 예를 들면 프린트 서버는 프린터 문서 출력을 처리하는 동시에 다른 프로그램이 자신에게 통신하는 것도 신경을 써야 한다.

1980년대 더 쉽게 컴퓨터끼리 통신이 가능하게 해주는 네트워크 관련 코드가 개발 됐다. 핵심은 프로그램이 여러 곳에서 들어오는 활동이나 동작을 기다리며 대기하가 적절한 핸들러를 호출할 수 있게 된 것이다.
하지만 GUI를 통한 대화식 프로그램으로 인해 상황이 달라졌다. 중간에 사용자의 입력을 기다리느라 핸들러가 중간에 대기해야 하는 경우가 많이 생겼다.

필요한 것은 핸들러를 인터럽트할 수 있게 만드는 것이다. 핸들러가 실행하는 중간에 잠시 실행을 중단하고 상태를 저장하고, 나중에 그 위치로 돌아와 실행을 재개할 수 있다는 뜻이다. 저장할 상태는 스택에 있다.
하지만 프로세스당 스택은 하나만 있다.

스레드는 정적인 데이터와 힙을 공유하지만 자체적으로 스택을 갖는 프로그램의 일부분을 말한다. 한 스레드에서 다른 스레드로 실행이 넘어갈 때는 스레드 스케줄러가 CPU 레지스터를 저장해야 한다.
스레드를 사용하면 한 프로세스 안에서 경합 조건을 만들 수 있기 때문에 흥미롭다. 하지만 스레드를 남용하면 여러가지 나쁜 경험을 야기할 수 있다.

1. 스레드는 데이터를 공유하여 보안문제가 발생할 수 있다.
2. 한 탭에서 문제가 발생하면 전체 프로세스가 멈춰버린다.
3. 어떤 스레드가 작업을 완료하는 데 너무 오랜 시간이 걸리면 다른 모든 스레드가 실행되지 못해서 문제가 생길 수 있다.
