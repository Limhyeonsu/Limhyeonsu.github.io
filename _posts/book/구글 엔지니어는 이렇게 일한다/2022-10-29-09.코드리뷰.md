---
title: 09. 코드 리뷰
date: 2022-10-29 23:38:04 +0900
categories: [BOOK, 구글 엔지니어는 이렇게 일한다]
tags: [software_engineering]  # TAG는 반드시 소문자로 이루어져야함!
---

코드 리뷰는 작성자 이외의 사람이 코드를 검토하는 프로세스로, 주로 코드를 코드베이스에 반영하기 전에 수행한다. 코드 리뷰는 `버그가 코드베이스로 침투하기 전에 잡아낸다`처럼 확실하고 쉽게 납득되는 이점을 제공한다.

## 9.1 코드 리뷰 흐름
코드 리뷰는 소프트웨어 개발 단계 곳곳에서 이루어질 수 있다. 구글에서는 변경을 코드베이스에 커밋하기 전에 수행한다. 코드 리뷰의 최종 목표는 다른 엔지니어로부터 해당 변경을 적용해도 된다는 합의를 이끌어내는 것이다. 합의한 엔지니어는 좋아보임(LGTM)이라는 태그를 달아 의사를 표현한다.

구글이 코드리뷰 절차) 234p


__코드는 부채다__

코드는 존재만으로 어느 순간 누군가 유지보수해야 할 대상이 되어 버린다.

새로운 기능이 필요한 상황은 아주 흔하다. 하지만 개발을 시작하기 앞서 정말 새로운 기능이 맞는지 주의 깊게 살펴봐야 한다.

중복 코드는 작성하는 시간 자체도 낭비지만 그 코드가 아예 존재하지 않을 때보다 관리 비용이 날이 갈수록 더 늘어나곤 한다. 이상적으로는 중복 확인이 먼저 이루어져야 한다.

코드 리뷰 전에는 내린 설계를 번복하거나 재논의하는 자리여서는 안된다. 설계를 결정하는 데는 보통 시간이 걸린다. 설계 후보를 수차례 제안하고, API 리뷰 회의에서 토론하고, 프로토타입을 만들어보기도 한다. 따라서 코드 리뷰 과정 자체를 기존 결정을 다시 논의할 기회로 보아서는 안 된다.

## 9.2 코드 리뷰 @ 구글
구글에서는 어떤 변경이든 승인을 얻으려면 다음의 세가지 측면에서 리뷰를 통과해야 한다.
1. 다른 엔지니어로부터 정확성과 이해 용이성을 평가 받는다. 의도한 작업을 코드가 적절히 수행하는지를 본다.
2. 변경되는 코드 영역을 관리하는 코드 소유자로부터 변경 코드가 적절하다는 승인을 받는다.(코드베이스에 변경을 반영하려면 해당 디렉터리 소유자의 승인이 반드시 필요하다.)
3. 가독성 승인을 받는다.

## 9.3 코드 리뷰의 이점
잘 설계된 코드 리뷰 프로세스와 코드 리뷰를 중요하게 다루는 문화가 주는 대표적인 이점으로
* 코드가 정확한지 확인해준다.
* 변경된 코드를 다른 엔지니어도 잘 이해한다.
* 코드베이스가 일관되게 관리된다.
* 팀이 소유권을 더 강하게 느낀다.
* 지식이 공유된다.
* 코드 리뷰 자체의 기록이 남는다.

### 9.3.1 코드 정확성
리뷰어는 일차적으로 변경된 코드의 정확성을 확인해주며 코드 리뷰가 주는 가장 확실한 이점이다. 한 연구에서 결함을 프로세스 초반에 잡아낼수록 나중에 발견해 고칠 때보다 시간이 덜 든다고 한다. 코드 리뷰에 들이는 시간은 테스트, 디버그, 회귀 테스트에 투입되는 시간을 줄여준다.

물론 `코드 리뷰 프로세스 자체를 단순화하여 가볍게 유지해야 한다.`는 거시 핵심이다. 무겁거나 확장하기 어렵다면 코드 리뷰를 지속할 수 없다.

정확성 평가가 주관적으로 흘러가지 않도록 하기 위해서 일반적으로 변경 작성자가 선택한 방식을 존중해야 한다. 리뷰어는 자신이 선호한다는 이유로 다른 안을 주장해서는 안 된다. 대안을 제시하는 것은 가능하지만 이해하기 쉽거나 기능을 개선하는 대안인 경우에만 그리해야 한다.

그리고 코드 정확성 검사는 도구를 사용하여 자동으로 수행할 수 있으나 이는 일반적으로 해당 변경이 의도대로 작동함을 보여준다. 하지만 새로운 코드가 이해하기 쉽고 세월이 흘러 코드베이스가 커져도 여전히 의미가 통할것이다. 라는 측면은 단순히 코드가 논리적으로 정확하다거나 이해되는지만 살피는 것으로 부족하다.

### 9.3.2 코드 이해 용이성
코드 리뷰는 일반적으로 작성자외의 누군가가 변경을 살펴볼 수 있는 첫 번째 기회이다. 코드는 작성되는 횟수보다 읽히는 횟수가 몇 배는 많으므로 이해하기 쉽게 작성하는 게 매우 중요하다. 코드의 정확성과 이해 용이성 검토는 다른 엔지니어가 LGTM을 주기 위해 평가하는 주요 기준이 된다.

### 9.3.3 코드 일관성
규모가 커지면 내가 작성한 코드를 결국은 다른 사람이 이용하게 되고 다른 사람이 유지보수하게 된다. 따라서 코드는 일정한 표준을 따라야 하며 그래야 조직 안에서 이해되고 유지보수될 수 있다. 너무 복잡해져서도 안 된다. 코드가 단순해야 다른 사람들이 이해하기 쉽고, 유지보수하기도 쉽다.

코드 리뷰 중 LGTM을 받은 상태와 가독성 승인을 분리한 이유는 유지보수성 때문이다.

코드는 일관되고 단순해야지 사람들이 쉽게 이해할 수 있고 리팩터링 도구가 더 쉽게 다룰 수 있다.

### 9.3.4 심리적, 문화적 이점
코드 리뷰는 문화적으로 중요한 이점을 제공한다. 소프트웨어 엔지니어에게 코드는 자신의 것이 아니라 협업을 통해 만들어지는 조직의 공동 소유물임을 인식시켜주는 효과이다. 코드리뷰는 작성자가 다른 사람의 피드백을 받아들이고, 또 더 큰 이익을 위해 적절히 타협하도록 이끌어준다.

자신의 코드에 대한 비판적 피드백이 달갑지 않은 것 역시 당연하다. 코드 리뷰는 이럴때 감정적으로 번질 수 있는 논쟁을 건전하게 만들어준다. 코드 리뷰가 제대로 작동한다면 작성자가 당연하게 여기던 가정이 틀릴 수 있음을 사전에 규정된 중립적인 방식으로 지적할 수 있다.

또 다른 심리적 이점은 검증이다. 뛰어난 엔지니어조차 가면 증후군을 겪거나 자기비판이 심할 수 있다. 코드 리뷰는 그들의 작업 결과를 검증하고 인정해주는 효과가 있다. 그리고 작성자들에게 자신의 코드를 한번 더 들여다보게 하는 효과가 생긴다. 코드 리뷰라는 장치가 없다면 수많은 사람이 자연스럽게 절차를 무시하려 들 것이다. 사소한 결함은 나중에 해결하겠다는 안일함으로 말이다.

### 9.3.5 지식 공유
리뷰 프로세스는 제안, 신기술 소개, 조언을 통해 리뷰어가 변경 작성자에게 도메인 지식을 전파하도록 이끌어준다. 코드 리뷰중 피드백을 주고 받는 과정에서 양방향 정보 교환이 이루어진다. 작성자는 물론 리뷰어도 새로운 기술이나 패턴을 배울 수 있다는 뜻이다.

리뷰를 통한 지식 공유는 지역, 국가, 프로젝트 경계에 구애받지 않고 코드베이스 구석구석의 모든 엔지니어에게 빠르게 전파된다.
