---
title: 4장 인프라를 지탱하는 기본 이론
date: 2022-07-05 23:36:39 +0900
categories: [BOOK, 그림으로 공부하는 IT 인프라 구조]
tags: [infra]  # TAG는 반드시 소문자로 이루어져야함!
---

## 4.1 직렬/병렬
### 4.1.1 직렬 병렬이란?
대규모 웹 서비스는 방대한 수의 사용자 요청을 처리해야 하므로 수많은 서버를 배치해서 병렬로 처리하고 있음을 알 수 있다. 주변에 병렬로 처리하는 경우가 많지만 무조건 병렬로 처리한다고 해서 성능이 향상되는 것은 아니다.

예) 여러 개의 물건이 일직선으로 나열돼 있는 것을 직렬, 두 줄 이상으로 나열돼 있는 것을 병렬이라고 한다.

<img src="">

위 그림에서 3차선 도로가 도중에 합류해서 1차선이 되고, 다시 3차선으로 분기하고 있다. 합류점부터 시작되는 1차산 구간은 혼잡해지기 쉽고 사고가 발생하기 쉽다. 1차선 구간은 전체 흐름을 느리게 만드는 __병목 지점__ 이 된다.
이러한 혼잡상황을 해결하는 방법으로는 1차선 구간을 3차선으로 만드는 것이다. 이것은 컴퓨터 세계에서도 마찬가지이다.

특정기간 내에 하나의 CPU로 처리할 수 있는 양에는 한계가 있지만 여러 개의 CPU를 배치하면 처리량을 늘릴 수 있다. 단 다수의 CPU를 이용할 수 있는 처리여야 한다는 전제 조건이 있다. 분담해서 병렬화할 수 없는 처리는 CPU 코어를 아무리 늘려도 효과가 없다.
병렬 처리에서는 합류점, 직렬화 구간, 분기점이 병목지점이 되기 싶다. 병렬 처리를 할 때는 가능한 한 병렬화해서 직렬 부분을 줄이고 어쩔 수 없이 직렬화해야 하는 경우에는 효율성을 높이는 것이 중요하다. 또 병렬화에서는 분담해서 일을 진행한 것을 다시 한 곳에 모으는 데 오버헤드가 걸린다. 무리해서 병렬화하면 직렬 처리에 의해 속도가 느려질 수 있다.

### 4.1.2 어디에 사용되나?
__웹 서버와 AP 서버에서의 병렬화__

웹 서버에서는 다수의 이용자가 접속하기 때문에 복수의 프로세스가 분담해서 병렬 처리를 하고 있다. AP 서버에서는 JVM 프로세스가 하나이지만 복수의 스레드가 병렬로 처리하고 있다. Apach HTTP Server에서는 멀티 프로세스 모델 외에도 멀티 프로세스와 멀티 스레드를 모두 이용하는 하이브리드형도 있다.

아파치는 1프로세스 1스레드, JVM은 1프로세스 4 스레드이지만 하나의 CPU 코어를 동시에 사용할 수 있는 것은 1스레드다.
예) 하나의 CPU 코어 밖에 없는 서버에서는 아파치 프로세스를 아무리 늘려도 동시에 실행할 수 있는 것은 1프로세스뿐이다. __프로세스나 스레드 수를 조정할 때는 CPU 코어 수도 함께 고려해야 한다__

__DB 서버에서의 병렬화__

오라클 DB에서는 클라이언트 요청을 접수하는 서버 프로세스가 클라이언트 접속 수만큼 생성된다. 서버 프로세스에는 공유 서버형이라 불리는 하이브리드형도 있어서 멀티 프로세스, 멀티 스레드를 모두 사용할 수 있다.
또 데이터 파일 생성 시 병목 현상이 발생하는 경우 메모리에 캐시된 갱신 완료 데이터를 HDD에 기록하는 DBWR 프로세스 수를 늘려서 병렬화할 수도 있다. 그 외에도 비동기 I/O를 사용해서 OS 측에서 쓰기 처리를 병렬화하는 방법도 있다.

### 4.1.3 정리
|     | 장점                                       | 단점                              |
|-----|------------------------------------------|---------------------------------|
| 직렬  | 구조가 간단, 설계 구현 난이도가 낮음                    | 복수의 리소스를 유용하게 이용할 수 없음          |
| 병렬  | 복수의 리소스를 유용하게 이용가능, 동일 시간당 처리할 수 있는 양 증가 | 오버헤드 발생, 구조가 복잡해서 설계 구현 난이도 증가  |

[병렬화시 주의점]
* 직렬 처리 성능은 향상되지 않지만 단위 시간당 처리량을 늘릴 수 있다.
* 합류점, 직렬화 구간, 분기점이 병목 지점이 되기 쉽다.
* 병렬화가 유효한 부분을 파악해서 병렬화하지 않으면 효과가 없다. 오버헤드, 구조 복잡성 등의 단점을 고려하고 단점 이상의 효과를 얻을 수 있는 경우 병렬화한다.

## 4.2 동기/비동기
### 4.2.1 동기/비동기란?
누군가에게 일을 부탁하고 그 일이 끝나기까지 잠자코 기다리는 것이 동기, 끝나면 말해 라고 말해두고 다른 일을 하는 것이 비동기다.

[특징]
* 동기는 일이 끝날 때까지 아무것도 하지 않고 기다리기 때문에 그 사이에 다른 일을 할 수 없다. 하지만 일이 끝났는지 여부를 확실하게 확인할 수 있다.
* 비동기는 끝날 때까지 기다리지 않기 때문에 병렬로 다른 일을 할 수 있다. 하지만 일이 끝났는지 여부 확인은 별도의 방법을 이용해야 한다.

### 4.2.2 어디에 사용되나?
Ajax를 사용하면 비동기 통신을 이용한 병렬 처리가 가능하다. Ajax를 사용한 웹 페이지에서는 비동기 통신이 가능해져서 화면을 보거나 입력하면서 필요한 부분만 갱신할 수 있게 됐다.

예) 구글에 검색어를 일부 입력하면 검색어 후보가 표시된다 -> 구글 검색 엔진 서버에 전송해서 키워드 후보 데이터를 얻어 브라우저에 표시

__DBMS에서 사용되는 비동기 I/O__ : DBMS는 HDD 등의 저장소에 비동기로 쓰기 처리를 할 수 있다. 이것을 비동기 I/O라고 한다. 공유 메모리에 있는 다수의 데이터를 프로세스가 HDD에 기록하는 경우, 비동기 I/O라면 하나의 I/O가 끝나기까지 기다리지 않고 다음 I/O를 발행할 수 있기 때문에 저장소 성능을 충분히 활용할 수 있다.
DBMS에서 비동기로 처리하면 쓰기가 끝났는지 확인하지 않고 다음 처리를 진행해서 위험하지 않는지 걱정할 수 있다. DBMS에서는 비동기로 I/O를 요구한 후에 I/O가 끝났는지 여부를 확인하고 있다.

### 4.2.3 정리
비동기의 본질은 병렬이다. 비동기를 사용시 주의할 점은 처리가 끝나지 않은 상태에서 다른 처리를 진행해도 문제가 없는가, 처리가 끝났는지 확인할 필요가 있는가를 고려해야한다.
