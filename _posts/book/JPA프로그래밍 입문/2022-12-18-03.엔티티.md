---
title: 3. 엔티티
date: 2022-12-18 17:40:38 +0900
categories: [BOOK, JPA 프로그래밍 입문]
tags: [sql]  # TAG는 반드시 소문자로 이루어져야함!
---

## 01. 엔티티 클래스
JPA에서 엔티티는 영속성을 가진 객체로서 가장 중요한 타입이다. JPA의 엔티티는 DB 테이블에 보관할 대상이 된다. EntityManager를 사용해서 엔티티 단위로 저장하고 조회하고 삭제한다.

JPA는 두 가지 방법으로 엔티티를 설정하는데 1)@Entity 애노테이션을 사용하는 방법 2)XML 매핑 설정을 사용하는 방법이 있다. 많은 프로젝트에서 주로 @Entity를 이용한 설정을 주로 사용한다.

### 1.1 @Entity 애노테이션과 @Table 애노테이션
EntityManager는 @Entity 애노테이션을 적용한 클래스를 이용해서 SQL 쿼리를 생성할 때 클래스 이름을 테이블 이름으로 사용한다. DBMS가 테이블 이름의 대소문자를 구분하거나 클래스 이름과 테이블 이름이 다른 경우 @Table 애노테이션을 사용해서 테이블 이름을 직접 지정할 수 있다.

### 1.2 @Id 애노테이션
엔티티의 가장 큰 특징은 식별자를 갖는다는 것이다. DB에서 주요키를 사용하는 것처럼 엔티티를 구분할 때 식별자를 사용한다.

```java
@Entity
public class User{

  @Id
  private String email;
  private String name;

  //...
}
```
@Id 애노테이션을 필드에 적용했는데 이 경우 모든 필드가 매핑 대상이 된다. 즉 email 뿐만 아니라 name 필드도 DB 테이블과의 매핑 대상이 된다. 필드뿐만 아니라 getter 메서드에도 @Id를 적용할 수도 있다.

@Id 애노테이션을 적용한 필드 값은 EntityManager.find() 메서드에서 엔티티 객체를 찾을 때 식별자로 사용된다.

## 1.3 @Basic 애노테이션과 지원 타입
@Id 애노테이션을 적용한 대상을 제외한 나머지 영속 대상은 @Basic 에노테이션을 이용해서 설정한다. 설정하지 않은 경우 생략한 것으로 생각하면 된다.

@Basic 애노테이션을 사용할 수 있는 타입으로는
* 자바의 기본 데이터타입
* 기본 데이터 타입에 대응하는 래퍼타입
* BigInteger, BigDecimal
* String
* Date, Calendar
* Date, Time, TimeStamp
* enum
* byte[], Byte[], char[], Character[]

날짜와 시간 타입은 Temporal 애노테이션과 함께 사용한다.

또 열거 타입에 대한 매핑은 Enumerated 애노테이션을 사용한다.
```java
public enum Grade{
  STAR1, STAR2, STAR3, STAR4, STAR5
}

@Entity
public class Hotel{
  @Id
  private String id;
  private String name;

  @Enumerated(EnumType.STRING)  //EnumType.STRING : 매핑된 칼럼이 열거 타입의 상수 이름을 값으로 가질 때 사용
  private Grade grade;

}
```
매핑된 컬럼이 열거 타입의 상수 이름 대신 인덱스를 저장하는 경우에는 EnumType.ORDINAL을 사용한다. __열거 타입 상수 순서는 유지보수 과정에서 변할 수 있다. 따라서 상수의 순서보다는 이름을 사용하는 것이 유리하다.__ EnumType.ORDINAL이 기본 값이므로 별도 설정을 추가하지 않으면 EnumType.ORDINAL을 사용하여 매핑을 처리한다.

## 1.4 @Column 애노테이션과 이름 지정
필드/프로퍼티의 이름과 테이블의 칼럼 이름이 다를 경우 @Column 애노테이션을 사용해서 컬럼 이름을 지정한다.
```java
@Entity
@Table(name="room_info")
public class Room{
  @Id
  private String number;
  private String name;

  @Column(name="description")
  private String desc;

  //...
}
```

## 1.5 @Column 애노테이션을 이용한 읽기 전용 매핑 설정
@Column을 사용하면 변경 내역이 DB에 반영되지 않는 읽기 전용 데이터를 설정할 수 있다.

예) 자동 증가하는 id 컬럼을 갖고 있는 경우 제약을 갖는다. 새로운 객체 생성시 insert 쿼리에서 제외되어야 하고, 이 필드를 수정해도 그 값이 DB 테이블에 반영되면 안 된다.

```java
@Entity
@Table(name="room_info")
public class Room{
  @Id
  private String number;
  private String name;

  @Column(name="description")
  private String desc;

  @Column(name="id", insertable=false, updatable=false)
  private Long dbId;
}
```
insertable=false이면 엔티티 객체를 DB에 저장시 insert 쿼리에서 해당 값을 제외한다. (update도 마찬가지)
