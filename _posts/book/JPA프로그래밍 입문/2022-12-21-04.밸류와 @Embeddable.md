---
title: 4. 밸류와 @Embeddable
date: 2022-12-21 23:02:12 +0900
categories: [BOOK, JPA 프로그래밍 입문]
tags: [sql]  # TAG는 반드시 소문자로 이루어져야함!
---

## 01. 밸류로 의미 더 드러내기
<img src="/assets/img/posting_img/book/JPA%20프로그래밍%20입문/밸류모델.jpeg" width="700px">

Hotel 클래스는 주소 자체를 의미하는 address 데이터를 갖고 있다. 그리고 Address 클래스는 zipcode, address1, address2를 데이터로 갖고 있어 따로 유추하지 않아도 주소가 우편번호, 주소1, 주소2로 구성된다는 것을 알 수 있다.

Address 클래스 같은 타입을 value라고 부르는데 value의 특징은 다음과 같다.
* value는 개념적으로 한 개의 값을 표현한다. (Address 클래스는 세 개의 데이터로 구성되어 있지만 개념적으로 한 개의 주소를 나타낸다.)
* 식별자를 갖지 않는다.
* 자신만의 라이프사이클을 갖지 않는다.(자신이 속한 객체가 생성될 때 함께 생성되고 삭제될 때 함께 삭제됨)

value 객체를 사용하는 이유는 값의 의미를 더 잘 드러내기 때문이다. zipcode, address1, address2 의 세 데이터보다 Address 클래스가 주소의 의미를 더 잘 드러낸다.

## 02. 밸류 클래스의 구현
기본 타입 값은 1)값을 비교한다. 2)값 자체는 바뀌지 않는다. 라는 특징을 갖고 있다. 밸류 클래스도 값으로 활용하기 위해 기본 타입 값 특징을 적용해볼 수 있다. 그러기 위해 다음과 같이 구현해야 한다.
* 생성 시점에 모든 프로퍼티를 파라미터로 받는다.
* 읽기 전용 프로퍼티만 제공한다.
* 각 프로퍼티의 값을 비교하도록 equals() 메서드를 재정의한다.
* hashCode() 메서드를 재정의 한다.

```java
@Entity
public class Hotel{
    @Id
    private String id;

    //…

    private Address address;
    public Address getAddress() {
        return address;
    }

    //주소를 변경하려면 다음 코드 처럼 Address 객체를 새로 할당한다.
    public void changeAddress(Address newAddress){
        this.address = newAddress;
    }
}
```

## 03. @Embeddable 애노테이션과 @Embedded 애노테이션을 이용한 밸류 매핑
Address 밸류 타입을 갖는 Hotel 엔티티를 테이블에 매핑하려면 다음과 같은 매핑 설정을 추가해야한다.
* 밸류 타입인 Address 클래스에 @Embeddable 애노테이션을 적용한다.
* Hotel 클래스는 @Embedded 애노테이션을 사용해서 밸류 타입을 매핑 설정한다.

```java
//대상 클래스가 다른 엔티티의 일부로 함께 저장될 수 있다는 것을 설정
@Embeddable
public class Address {
  private String zipcode;
  private String address1;
  private String address2;
}

@Entity
public class Hotel{
  @Id
  private String id;
  private String name;
  @Eumerated(EnumType.STRING)
  private Grade grade;

  //@Embeddable 클래스의 인스턴스라는 것을 설정한다.
  @Embedded
  priavate Address address;
}

//사용 예제
Hotel hotel = em.find(Hotel.class, "H100-10");
Address address = hotel.getAddress();
//address.getAddress1();
//address.getAddress2();
//address.getZipcode();
```
Hotel의 address도 매핑 대상이므로 트랜잭션 범위 안에서 address가 변경되면 UPDATE 쿼리를 실행해서 변경 내역을 DB에 반영한다.

### 3.1 null 밸류의 매핑 처리
```java
public Hotel(String id, String name, Grade grade, Address address){
  this.id = id;
  this.name = name;
  this.grade = grade;
  this.address = address;
}
```
위와 같은 생성자가 정의되어 있을 때 address 파라미터를 null로 주고 저장하면 Address와 매핑된 세 개의 칼럼에 모두 null 값이 할당된다. 그리고 조회할 때 매핑 대상도 null이 된다.

### 3.2 @Embeddable의 접근 타입
기본적으로 @Embedded로 매핑한 대상은 해당 엔티티의 접근 타입을 따른다. 예) 위 예제에서 Hotel 클래스는 필드 접근 타입을 사용하므로 @Embedded로 매핑한 Address를 처리할 때에도 필드 접근 타입을 사용한다.

반대로 Hotel 클래스에서 프로퍼티 접근 타입을 사용하면 Address 프로퍼티도 프로퍼티 접근 타입을 따른다. 그래서 Address 클래스도 프로퍼티 처리를 위한 get/set 메서드를 정의해야 한다.

만약 Address 클래스에 항상 필드 접근 방식을 사용해서 처리하려는 경우 Address 클래스에 @Access 애노테이션을 사용해서 @Embeddable의 접근 타입을 고정하면 된다.
