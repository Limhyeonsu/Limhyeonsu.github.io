---
title: 4장 한계 돌파를 위한 노력, Mock을 이용한 TDD
date: 2022-05-11 24:10:45 +0900
categories: [BOOK, TDD 실천법과 도구]
tags: [tdd]  # TAG는 반드시 소문자로 이루어져야함!
---

### 4.1 Mock 객체
#### Mock 객체란 무엇인가?
Mock 이란 조각하기 쉬운 재료를 이용하여 추후 만들어질 제춤의 외양을 흉내 낸 모조품을 말한다. 즉 실제 모듈과 비슷하게 보이도록 만든 가짜 객체를 Mock 객체라고 한다.

예) 사용자 암호를 변경하는 기능을 구현하기 위해 테스트 케이스를 작성하는데 추가 요구사항으로 사용자의 패스워드를 반드시 암호화한 다음에 저장해야 한다.
암호화 모듈의 스펙은 interface로 정해져 있고, 이 모듈은 다른 팀에서 구현하기로 결정한다고 했을 때 다른팀에서 암호화 모듈을 완성할 때까지 테스트를 진행하기가 어렵다.
이럴때 스펙이 정해져 있으니 암호화 모듈처럼 보이는 객체를 만들어서 테스트에 사용할 수 있다.

정리하자면 __우리가 구현하는데 필요하지만 실제로 준비하기엔 여러가지 어려움이 따르는 대상을 필요한 부분만큼만 채워서 만들어진 객체__ 를 말한다.

#### 언제 Mock 객체를 만들 것인가?
테스트 케이스 작성이 어려운 상황과 Mock 객체가 필요한 상황은 종종 일치하곤 한다. 대부분의 경우 모듈이 가진 `의존성`이 근본적인 원인이 된다. 모듈이 필요로 하는 읜존성은 테스트 작성을 어렵게 만든다.
그리고 그 의존성을 단절시키기 위해 Mock 객체가 사용된다.

1. 테스트 작성을 위한 환경 구축의 어려운 경우 : 환경 구축을 위한 작업시간이 많이 필요한 경우, 특정 모듈을 아직 갖고 있지 않아서 ,타 부서와의 협의나 정책이 필요한 경우에 Mock이 필요하다.
2. 테스트가 특정 경우나 순간에 의존적인 경우 : 특히 예외처리를 테스트할 때 많이 접한다. Mock을 이용하면 특정 상태를 가상으로 만들어놓을 수 있다.
3. 테스트 시간이 오래 걸리는 경우

### 4.2 Mock에 대한 기본적인 분류 개념, 테스트 더블
제라드 메스자로스가 만든 단어로 테스트 더블은 오리지널 객체를 사용해서 테스트를 진행하기 어려울 경우 이를 대신해서 테스트를 진행할 수 있도록 만들어주는 객체를 지칭한다. Mock 객체는 테스트 더블의 하위로 분류되어 있다.

예) 고객이 쿠폰을 발급받아 저장하고, 그 내역을 확인할 수 있는 기능 구현
```
public interface ICoupon {
  public String getName();                //쿠폰 이름
  public boolean isValid();               //쿠폰 유효 여부 확인
  public int getDiscountPercent();        //할인율
  public boolean isAppliable(Item item);  //해당 아이템에 적용 가능 여부
  public void doExpire();                 //사용할 수 없는 쿠폰으로 만듬
}
```
```
public class UserTest{
  @Test
  public void testAddCoupon() throws Exception {
    User user = new User("area88");
    assertEquals("쿠폰 수령 전", 0, user.getTotalCouponCount());

    ICoupon coupon = ?????

    user.addCoupon(coupon);
    assertEquals("쿠폰 수령 후", 1, user.getTotalCouponCount());
  }
}
```
위 예제에서 ICoupon은 테스트 대상은 아니고 테스트에 사용되는 일종의 테스트 픽스처이다. 하지만 이 구현 객체가 없으면 정상적인 테스트 케이스를 작성할 수 없다. 이때 테스트 더블을 활용하여 이 상황을 극복할 수 있다.

#### 더미 객체
더미 객체는 단순한 껍데기에 해당한다. 오로지 인스턴스화될 수 있는 수준으로만 ICoupon 인터페이스를 구현한 객체다.
```
public class DummyCoupon implements ICoupon{
    @Override
    public String getName() {
        return null;
    }

    @Override
    public boolean isValid() {
        return false;
    }

    @Override
    public int getDiscountPercent() {
        return 0;
    }

    @Override
    public boolean isAppliable(Item item) {
        return false;
    }

    @Override
    public void doExpire() {

    }
}
```
```
public class UserTest{
  @Test
  public void testAddCoupon() throws Exception {
  User user = new User("area88");
  assertEquals("쿠폰 수령 전", 0, user.getTotalCouponCount());

      ICoupon coupon = new DummyCoupon();

      user.addCoupon(coupon);
      assertEquals("쿠폰 수령 후", 1, user.getTotalCouponCount());
  }
}
```
더미 객체는 단지 인스턴스화된 객체가 필요할 뿐 해당 객체의 기능까지는 필요하지 않은 경우에 사용한다.(정상 동작은 보장되지 않음)
