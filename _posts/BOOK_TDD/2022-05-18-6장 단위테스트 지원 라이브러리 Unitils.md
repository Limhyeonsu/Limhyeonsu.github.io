---
title: 6장 단위테스트 지원 라이브러리:Unitils
date: 2022-05-16 22:28:45 +0900
categories: [BOOK, TDD 실천법과 도구]
tags: [tdd]  # TAG는 반드시 소문자로 이루어져야함!
---

### 6.1 Unitils를 사용하기 위한 환경 준비
Unitils 라이브러리를 사이트에서 내려 받고, 클래스패스에 포함시켜준다. JUnit4와 마찬가지로 static import를 주로 사용한다.

### 6.2 Unitils의 단위 테스트 지원 기능들
#### 객체 동치성 비교
테스트 케이스를 작성하다 보면 객체끼리 동치성 비교를 해야하는 경우가 흔히 발생한다.
```
@Test
public void testBook() {
  Book abook = new Book("사람은 무엇으로 사는가?", "톨스토이", "9000");
  Book otherBook = new Book("사람은 무엇으로 사는가?", "톨스토이", "9000");
  assertEquals(aBook, otherBook); //fail
}
```
객체의 비교는 단순히 참조 비교를 하기 때문에 두 객체는 의도된 객체의 상태 측면에서는 동일하지만 결과는 두 객체가 서로 다르다고 판정한다.
그래서 다음과 같이 각 필드를 비교해야 한다.
```
assertEquals(aBook.getName(), otherBook.getName())
assertEquals(aBook.getAuthor(), otherBook.getAuthor())
assertEquals(aBook.getPrice(), otherBook.getPrice())
```

#### 리플렉션 단정문
객체의 필드에 저장되어 있는 값을 알아서 비교해주는 기능이다.

`assertReflectionEquals(예상객체, 실제객체);`, `assertReflectionEquals([메시지], 예상객체, 실제객체);`

```
@Test
public void testBook() {
  Book abook = new Book("사람은 무엇으로 사는가?", "톨스토이", "9000");
  Book otherBook = new Book("사람은 무엇으로 사는가?", "톨스토이", "9000");
  assertReflectionEquals("Book 객체 필드 비교", aBook, otherBook);
}
```

#### 리플렉션 단정문의 너그러운 비교
리플렉션 단정문에는 몇 가지 옵션을 지정할 수 있는데 대부분 리팩토링이 일어나면서 발생하는 테스트 케이스의 깨짐을 보완하기 위해 사용된다. 이러한 방식을 '너그러운 단정문' 적용 이라고 한다.

`assertReflectionEquals(예상객체, 실제객체, ReflectionComparatorMode)`

[ReflectionComparatorMode] - 대상을 비교할 때 좀 더 유연한 비교를 할 수 있도록 세 가지 옵션을 제공한다.
* LENIENT_ORDER : 컬렉션, 배열을 비교할 때 순서 무시
* IGNORE_DEFAULTS : 예상 객체 필드 중 타입 기본값을 갖는 필드에 대해서는 비교하지 않음 단, 필드 기본값을 비교해서 제외하는 것은 예상 객체를 기준으로 한다.
* LENIENT_DATES : 시간, 날짜 타입은 비교하지 않음

**Unitils에는 `assertLenientEquals`라는 것이 있는데 이는 assertReflectionEquals의 간략화 버전으로 세 개의 옵션 중 LENIENT_DATES을 제외한 두 개를 동시에 적용해서 비교하는 버전이다.

#### 프로퍼티 단정문
보통 특정 필드에 값이 제대로 할당됐는지 확인하는 가장 간단한 방법은 getter 메소드를 통해서 값을 직접 확인한다. 하지만 경우에 따라서는 getter 메소드가 제공되지 않는 경우도 있다.
그럴때는 Unitils의 assertPropertyLenientEquals를 이용하면 된다. `assertPropertyLenientEquals(속성이름, 예상되는 속성값, 실제 객체)`

assertPropertyLenientEquals는 자바빈 규칙을 따르는 식으로 프로퍼티를 비교한다. 추후 getter 메소드가 생기게 되면 assertPropertyLenientEquals는 해당 bean 규약에 맞는 getter 메소드를 이용해 프로퍼티 값을 불러와서 비교를 수행한다.

### 6.3 Unitils 모듈
Unitils의 모듈은 다양한 서비스를 제공하는데 테스트 케이스 작성시 해당 모듈을 사용하려면 UnitilsJUnit3, UnitilsJUnit3, UnitilsJUnit4, UnitilsTestNG 등의 Test Listener가 필요하다.
Test Listener를 사용하려면 Test Listener를 테스트 클래스가 상속하거나 @RunWith 같은 애노테이션으로 Test Runner로 지정하면 된다.

[모듈 종류]
* DatabaseModule : 데이터베이스 관리와 커넥션 풀 관련
* DbUnitModule : DbUnit을 사용할 때 사용하는 테스트 데이터 관리
* HibernateModule : 하이버네이트 설정 지원과 DB 매핑 체크
* MockModule : Unitils에서 제공하는 Mock 프레임워크
* EasyMockModule : EasyMock 지원 기능
* InjectModule : 오브젝트를 강제로 할당시켜 버리는 Injection 기능
* SpringModule : 스프링의 애플리케이션 컨텍스트 지원과 스프링 빈의 주입 기능
