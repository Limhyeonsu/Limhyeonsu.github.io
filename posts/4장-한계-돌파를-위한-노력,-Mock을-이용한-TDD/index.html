<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="4장 한계 돌파를 위한 노력, Mock을 이용한 TDD" /><meta property="og:locale" content="en" /><meta name="description" content="4.1 Mock 객체 Mock 객체란 무엇인가? Mock 이란 조각하기 쉬운 재료를 이용하여 추후 만들어질 제춤의 외양을 흉내 낸 모조품을 말한다. 즉 실제 모듈과 비슷하게 보이도록 만든 가짜 객체를 Mock 객체라고 한다." /><meta property="og:description" content="4.1 Mock 객체 Mock 객체란 무엇인가? Mock 이란 조각하기 쉬운 재료를 이용하여 추후 만들어질 제춤의 외양을 흉내 낸 모조품을 말한다. 즉 실제 모듈과 비슷하게 보이도록 만든 가짜 객체를 Mock 객체라고 한다." /><link rel="canonical" href="https://limhyeonsu.github.io/posts/4%EC%9E%A5-%ED%95%9C%EA%B3%84-%EB%8F%8C%ED%8C%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%85%B8%EB%A0%A5,-Mock%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-TDD/" /><meta property="og:url" content="https://limhyeonsu.github.io/posts/4%EC%9E%A5-%ED%95%9C%EA%B3%84-%EB%8F%8C%ED%8C%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%85%B8%EB%A0%A5,-Mock%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-TDD/" /><meta property="og:site_name" content="Hyeonsu Lim" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-12T00:10:45+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="4장 한계 돌파를 위한 노력, Mock을 이용한 TDD" /><meta name="twitter:site" content="@imhyeon99494867" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-07T23:27:22+09:00","datePublished":"2022-05-12T00:10:45+09:00","description":"4.1 Mock 객체 Mock 객체란 무엇인가? Mock 이란 조각하기 쉬운 재료를 이용하여 추후 만들어질 제춤의 외양을 흉내 낸 모조품을 말한다. 즉 실제 모듈과 비슷하게 보이도록 만든 가짜 객체를 Mock 객체라고 한다.","headline":"4장 한계 돌파를 위한 노력, Mock을 이용한 TDD","mainEntityOfPage":{"@type":"WebPage","@id":"https://limhyeonsu.github.io/posts/4%EC%9E%A5-%ED%95%9C%EA%B3%84-%EB%8F%8C%ED%8C%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%85%B8%EB%A0%A5,-Mock%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-TDD/"},"url":"https://limhyeonsu.github.io/posts/4%EC%9E%A5-%ED%95%9C%EA%B3%84-%EB%8F%8C%ED%8C%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%85%B8%EB%A0%A5,-Mock%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-TDD/"}</script><title>4장 한계 돌파를 위한 노력, Mock을 이용한 TDD | Hyeonsu Lim</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hyeonsu Lim"><meta name="application-name" content="Hyeonsu Lim"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile_img.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hyeonsu Lim</a></div><div class="site-subtitle font-italic">Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Limhyeonsu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/imhyeon99494867" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gustn72096','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>4장 한계 돌파를 위한 노력, Mock을 이용한 TDD</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>4장 한계 돌파를 위한 노력, Mock을 이용한 TDD</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1652281845" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-12 </em> </span> <span> Updated <em class="timeago" data-ts="1670423242" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-07 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4496 words"> <em>24 min</em> read</span></div></div></div><div class="post-content"><h3 id="41-mock-객체"><span class="mr-2">4.1 Mock 객체</span><a href="#41-mock-객체" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="mock-객체란-무엇인가"><span class="mr-2">Mock 객체란 무엇인가?</span><a href="#mock-객체란-무엇인가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Mock 이란 조각하기 쉬운 재료를 이용하여 추후 만들어질 제춤의 외양을 흉내 낸 모조품을 말한다. 즉 실제 모듈과 비슷하게 보이도록 만든 가짜 객체를 Mock 객체라고 한다.</p><p>예) 사용자 암호를 변경하는 기능을 구현하기 위해 테스트 케이스를 작성하는데 추가 요구사항으로 사용자의 패스워드를 반드시 암호화한 다음에 저장해야 한다. 암호화 모듈의 스펙은 interface로 정해져 있고, 이 모듈은 다른 팀에서 구현하기로 결정한다고 했을 때 다른팀에서 암호화 모듈을 완성할 때까지 테스트를 진행하기가 어렵다. 이럴때 스펙이 정해져 있으니 암호화 모듈처럼 보이는 객체를 만들어서 테스트에 사용할 수 있다.</p><p>정리하자면 <strong>우리가 구현하는데 필요하지만 실제로 준비하기엔 여러가지 어려움이 따르는 대상을 필요한 부분만큼만 채워서 만들어진 객체</strong> 를 말한다.</p><h4 id="언제-mock-객체를-만들-것인가"><span class="mr-2">언제 Mock 객체를 만들 것인가?</span><a href="#언제-mock-객체를-만들-것인가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>테스트 케이스 작성이 어려운 상황과 Mock 객체가 필요한 상황은 종종 일치하곤 한다. 대부분의 경우 모듈이 가진 <code class="language-plaintext highlighter-rouge">의존성</code>이 근본적인 원인이 된다. 모듈이 필요로 하는 읜존성은 테스트 작성을 어렵게 만든다. 그리고 그 의존성을 단절시키기 위해 Mock 객체가 사용된다.</p><ol><li>테스트 작성을 위한 환경 구축의 어려운 경우 : 환경 구축을 위한 작업시간이 많이 필요한 경우, 특정 모듈을 아직 갖고 있지 않아서 ,타 부서와의 협의나 정책이 필요한 경우에 Mock이 필요하다.<li>테스트가 특정 경우나 순간에 의존적인 경우 : 특히 예외처리를 테스트할 때 많이 접한다. Mock을 이용하면 특정 상태를 가상으로 만들어놓을 수 있다.<li>테스트 시간이 오래 걸리는 경우</ol><h3 id="42-mock에-대한-기본적인-분류-개념-테스트-더블"><span class="mr-2">4.2 Mock에 대한 기본적인 분류 개념, 테스트 더블</span><a href="#42-mock에-대한-기본적인-분류-개념-테스트-더블" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>제라드 메스자로스가 만든 단어로 테스트 더블은 오리지널 객체를 사용해서 테스트를 진행하기 어려울 경우 이를 대신해서 테스트를 진행할 수 있도록 만들어주는 객체를 지칭한다. Mock 객체는 테스트 더블의 하위로 분류되어 있다.</p><p>예) 고객이 쿠폰을 발급받아 저장하고, 그 내역을 확인할 수 있는 기능 구현</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ICoupon</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>                <span class="c1">//쿠폰 이름</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">();</span>               <span class="c1">//쿠폰 유효 여부 확인</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getDiscountPercent</span><span class="o">();</span>        <span class="c1">//할인율</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAppliable</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">);</span>  <span class="c1">//해당 아이템에 적용 가능 여부</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doExpire</span><span class="o">();</span>                 <span class="c1">//사용할 수 없는 쿠폰으로 만듬</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserTest</span><span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddCoupon</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"area88"</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 수령 전"</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getTotalCouponCount</span><span class="o">());</span>

    <span class="nc">ICoupon</span> <span class="n">coupon</span> <span class="o">=</span> <span class="o">?????</span>

    <span class="n">user</span><span class="o">.</span><span class="na">addCoupon</span><span class="o">(</span><span class="n">coupon</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 수령 후"</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getTotalCouponCount</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 예제에서 ICoupon은 테스트 대상은 아니고 테스트에 사용되는 일종의 테스트 픽스처이다. 하지만 이 구현 객체가 없으면 정상적인 테스트 케이스를 작성할 수 없다. 이때 테스트 더블을 활용하여 이 상황을 극복할 수 있다.</p><h4 id="더미-객체"><span class="mr-2">더미 객체</span><a href="#더미-객체" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>더미 객체는 단순한 껍데기에 해당한다. 오로지 인스턴스화될 수 있는 수준으로만 ICoupon 인터페이스를 구현한 객체다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DummyCoupon</span> <span class="kd">implements</span> <span class="nc">ICoupon</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getDiscountPercent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAppliable</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doExpire</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserTest</span><span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAddCoupon</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"area88"</span><span class="o">);</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 수령 전"</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getTotalCouponCount</span><span class="o">());</span>

      <span class="nc">ICoupon</span> <span class="n">coupon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DummyCoupon</span><span class="o">();</span>

      <span class="n">user</span><span class="o">.</span><span class="na">addCoupon</span><span class="o">(</span><span class="n">coupon</span><span class="o">);</span>
      <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 수령 후"</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getTotalCouponCount</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>더미 객체는 단지 인스턴스화된 객체가 필요할 뿐 해당 객체의 기능까지는 필요하지 않은 경우에 사용한다.(정상 동작은 보장되지 않음)</p><h4 id="테스트-스텁"><span class="mr-2">테스트 스텁</span><a href="#테스트-스텁" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>테스트 스텁은 더미 객체가 마치 실제로 동작하는 것처럼 보이게 만들어놓은 객체다. 더미 객체와 다르게 테스트 스텁은 객체의 특정 상태를 가정해서 만들어놓은 단순 구현체다. 특정 값을 리턴해주거나 특정 메시지를 출력하는 등의 작업을 한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StubCoupon</span> <span class="kd">implements</span> <span class="nc">ICoupon</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"VIP 고객 한가위 감사쿠폰"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getDiscountPercent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">7</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAppliable</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doExpire</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>단지 인스턴스화될 수 있는 객체 수준이면 더미, 인스턴스화된 객체가 특정 상태나 모습을 대표하면 스텁이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetLastOccupiedCoupone</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"area88"</span><span class="o">);</span>
  <span class="nc">ICoupon</span> <span class="n">coupon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StubCoupone</span><span class="o">();</span>
  <span class="n">user</span><span class="o">.</span><span class="na">addCoupon</span><span class="o">(</span><span class="n">coupon</span><span class="o">);</span>
  <span class="nc">ICoupone</span> <span class="n">lastCoupone</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getLastOccupiedCoupone</span><span class="o">();</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 할인율"</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="n">lastCoupone</span><span class="o">.</span><span class="na">getDiscountPercent</span><span class="o">());</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰 이름"</span><span class="o">,</span> <span class="s">"VIP 고객 한가위 감사 쿠폰"</span><span class="o">,</span> <span class="n">userCoupone</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="o">}</span>
</pre></table></code></div></div><p>스텁은 특정 객체가 상태를 대신해주고 있긴 하지만 하드코딩된 형태이기 때문에 로직이 들어가는 부분은 테스트할 수 없다. 특정 쿠폰이 구매 제품에 적용되는지 여부에 따라 결제액이 바뀌는걸 테스트하는 경우 할인이 적용되는 아이템과 할인이 적용되지 않은 아이템에 대한 테스트가 필요하다. 이런 경우 아이템에 따라 쿠폰이 적용 가능한지 안한지로 판단하여 하드코딩 하여 작성할 수 있다.</p><p>이렇게 테스트 더블로 만들어진 객체가 발전하면 단순 스텁을 벗어나서 실제 로직이 구현된 것처럼 보이는데 그런 객체를 페이크 객체라고 한다.</p><h4 id="페이크-객체"><span class="mr-2">페이크 객체</span><a href="#페이크-객체" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>페이크 객체는 스텁과 경계를 구분짓기 어려우나 스텁은 하나의 인스턴스를 대표하는데 주로 쓰이고, 페이크는 여러 개의 인스턴스를 대표할 수 있는 경우이거나 좀 더 복잡한 구현이 들어가 있는 객체를 지칭한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FakeCoupone</span> <span class="n">implement</span> <span class="nc">ICoupone</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">categoryList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>

  <span class="kd">public</span> <span class="nf">FakeCoupone</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">categoryList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"부엌칼"</span><span class="o">);</span>
    <span class="n">categoryList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"아동 장난감"</span><span class="o">);</span>
    <span class="n">categoryList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"조리기구"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAppliable</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">categoryList</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getCategory</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">retuen</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>페이크 객체는 복잡한 로직이나 객체 내부에서 필요로 하는 다른 외부 객체들의 동작을, 비교적 단순화하여 구현한 객체다. (복잡도 = 더미 &lt; 테스트 스텁 &lt; 페이크 객체)</p><h4 id="테스트-스파이"><span class="mr-2">테스트 스파이</span><a href="#테스트-스파이" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>테스트에 사용되는 객체에 대해서도 특정 객체가 사용됐는지 그리고 객체의 예상된 메소드가 정상적으로 호출됐는지를 확인해야 하는 상황이 발생한다. 보통은 호출 여부를 몰래 감시해서 기록했다가, 나중에 요청이 들어오면 해당 기록 정보를 전달해준다. 그런 목적으로 만들어진 테스트 더블을 테스트 스파이라고 부른다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetOrderPrice_discounableItem</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="nc">PriceCalculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PriceCalculator</span><span class="o">();</span>
  <span class="nc">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Item</span><span class="o">(</span><span class="s">"LightSavor"</span><span class="o">,</span> <span class="s">"부엌칼"</span><span class="o">,</span> <span class="mi">100000</span><span class="o">);</span>
  <span class="nc">ICoupon</span> <span class="n">coupon</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FakeCoupon</span><span class="o">();</span>

  <span class="c1">//getOrderPrice를 구하기 위해서는 isAppliable 메소드가 1번 호출되어야 한다는 것이 가정되어 있다.</span>
  <span class="n">assertEquals</span><span class="o">(</span><span class="s">"쿠폰으로 인해 할인된 가격"</span><span class="o">,</span> <span class="mi">93000</span><span class="o">,</span> <span class="n">calculator</span><span class="o">.</span><span class="na">getOrderPrice</span><span class="o">(</span><span class="n">item</span><span class="o">,</span> <span class="n">coupon</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAppliable</span><span class="o">(</span><span class="nc">Item</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">isAppliableCallCount</span><span class="o">++;</span> <span class="c1">//호출되면 증가</span>
    <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">categoryList</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getCategory</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">//테스트 스파이</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getIsAppliableCallCount</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">isAppliableCallCount</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>테스트 스파이는 아주 특수한 경우를 제외하고 잘 쓰이지 않는다. 대부분의 Mock 프레임워크들은 기본적으로 테스트 스파이 기능을 제공해준다.</p><p>[상태 기반 테스트, 행위 기반 테스트] 상태 기반 테스트는 테스트 대상 클래스의 메소드를 호출하고, 그 <code class="language-plaintext highlighter-rouge">결과 값과 예상 값을 비교</code>하는 식이다. 특정 메소드를 거친 후, 객체의 상태에 대해 예상값과 비교하는 방식이 상태 기반 테스트이다.</p><p>행위 기반 테스트는 올바른 로직 수행에 대한 판단의 근거로 <code class="language-plaintext highlighter-rouge">특정한 동작의 수행 여부</code>를 이용한다.</p><h4 id="mock-객체"><span class="mr-2">Mock 객체</span><a href="#mock-객체" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>일반적으로 테스트 더블은 상태 기반으로 테스트 케이스를 작성하고, Mock 객체는 행위를 기반으로 테스트 케이스를 작성한다. 행위기반 테스트는 복잡한 시나리오가 사용되는 경우가 많고, 모양이나 작성 등 여러가지 측면에서 어색한 경우가 많기 때문에 만일 상태 기반으로 테스트를 할 수 있는 상황이라면 굳이 행위 기반 테스트 케이스는 만들지 않는 것이 좋다.</p><h4 id="mock-객체라는-용어가-주는-혼란스러움-정리"><span class="mr-2">Mock 객체라는 용어가 주는 혼란스러움 정리</span><a href="#mock-객체라는-용어가-주는-혼란스러움-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Mock 객체는 넓은 의미로 일반적인 가성 임시 구현체의 의미로 사용되는 경우가 많다. 테스트 더블과 거의 동등한 의미로 사용되는 경우가 많았기 때문에 따라서 Mock 객체라는 단어를 테스트 더블과 동일한 의미로 사용할 것이다.</p><p>**테스트 케이스 작성시 매번 클래스를 구현하는 것은 번거로울 수 있다 그럴땐 명시적인 클래스 보다는 ‘익명 클래스’로 만들어서 사용하</p><h3 id="43-mock-프레임워크"><span class="mr-2">4.3 Mock 프레임워크</span><a href="#43-mock-프레임워크" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Mock 프레임워크는 동적으로 Mock 객체를 만들어주는 프레임워크를 지칭한다. Mock 프레임워크 종류로는 EasyMock, jMock, Mockito가 있다. 이중 Mockito는 간편함과 기존 Mock 프레임워크들이 지향했던 행위 기반 테스트 위주에서 상태 위주 테스트로의 회귀를 전면으로 내세우고 있다.</p><h4 id="easymock"><span class="mr-2">EasyMock</span><a href="#easymock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>스프링 프레임워크에서 테스트로 사용하는 EasyMock 이다. 기본적으로 Recode &amp; Replay라는 메타포를 사용하며 네 단계로 동작한다.</p><ul><li>createMock : 인터페이스에 해당하는 Mock 객체를 만든다.<li>Record : Mock 객체 메소드의 예상되는 동작을 녹화한다.<li>Replay : 예정된 상태로 재생한다.<li>Verify : 예상했던 행위가 발생했는지 검증한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">//1. createMock</span>
<span class="nc">List</span> <span class="nc">MockList</span> <span class="o">=</span> <span class="n">createMock</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>

<span class="c1">//2. Record</span>
<span class="c1">//녹화</span>
<span class="n">expect</span><span class="o">(</span><span class="nc">Mock</span> <span class="n">객체의</span> <span class="n">메소드</span><span class="o">).</span><span class="na">andReturn</span><span class="o">(</span><span class="n">예상</span> <span class="n">결과값</span><span class="o">);</span>
<span class="c1">//재생</span>
<span class="n">replay</span><span class="o">(</span><span class="nc">Mock</span> <span class="n">객체</span><span class="o">);</span>

<span class="n">expect</span><span class="o">(</span><span class="n">mockList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"item"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">expect</span><span class="o">(</span><span class="n">mockList</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">items</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">mockList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
<span class="n">replay</span><span class="o">(</span><span class="n">mockList</span><span class="o">);</span>
</pre></table></code></div></div><p>녹화 및 재생은 Mock 객체가 만들어진 이후부터 재생이 호출되기 전까지 동작이 기록된다. 행위 기록이기 때문에 횟수를 지정할 수도 있다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//3. 검증 verify(Mock_객체);</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">listMockTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="n">mockList</span> <span class="o">=</span> <span class="n">createMock</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">expect</span><span class="o">(</span><span class="n">mockList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"item"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">expect</span><span class="o">(</span><span class="n">mockList</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">items</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
  <span class="n">mockList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
  <span class="n">replay</span><span class="o">(</span><span class="n">mockList</span><span class="o">);</span>
  <span class="n">verify</span><span class="o">(</span><span class="n">mockList</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="jmock"><span class="mr-2">jMock</span><a href="#jmock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>jMock은 다른 프레임워크와 구별되는 몇 가지 독특한 차이점을 목표로 개발되었는데 특히 테스트의 표현 확대와 가독성 증진에 많은 노력이 들어가 있다.</p><p>[특징]</p><ol><li>연쇄 호출 : 동일 객체에 여러 개의 메시지를 보낼 때 발생하는 번잡스러움을 해결하기 위해 만들어진 스타일이다. 사전에 특정 워크플로를 만들어놓고, 해당 순서에 해당하는 객체를 리턴하는 방식으로 변경한다.</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">//전</span>
<span class="n">bookedTicket</span><span class="o">.</span><span class="na">setDeparture</span><span class="o">(</span><span class="no">A</span><span class="o">);</span>
<span class="n">bookedTicket</span><span class="o">.</span><span class="na">setArrival</span><span class="o">(</span><span class="no">B</span><span class="o">);</span>
<span class="n">bookedTicket</span><span class="o">.</span><span class="na">setDepartureDate</span><span class="o">(</span><span class="n">date</span><span class="o">);</span>
<span class="n">bookedTicket</span><span class="o">.</span><span class="na">setAdditionalFare</span><span class="o">(</span><span class="n">fare</span><span class="o">);</span>

<span class="c1">//후</span>
<span class="n">bookedTicket</span><span class="o">.</span><span class="na">departure</span><span class="o">(</span><span class="no">A</span><span class="o">)</span>
            <span class="o">.</span><span class="na">arrival</span><span class="o">(</span><span class="no">B</span><span class="o">)</span>
            <span class="o">.</span><span class="na">departureDate</span><span class="o">(</span><span class="n">date</span><span class="o">)</span>
            <span class="o">.</span><span class="na">additionalFare</span><span class="o">(</span><span class="n">fare</span><span class="o">);</span>
</pre></table></code></div></div><ol><li>전용 Matcher 사용 : 기본적으로 Hamcrest Matcher 라이브러리를 사용하고 있다.<ul><li>CreateMock : 인터페이스에 해당하는 Mock 객체를 만든다.<li>Expect : Mock 객체 메소드의 예상되는 동작을 미리 지정 한다.<li>Exercise : 테스트 메소드 내에서 Mock 객체를 사용한다.<li>Verify : 예상했던 행위가 발생했는지 검증한다.</ul><li>예상 동작 지정 및 테스트 수행<li>예상값 지정하기<li>검증 : 프레임워크가 알아서 처리해주기 때문에 명시적으로 검증을 표시할 필요가 없다.</ol><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">//1. 테스트 픽스처 클래스 정의와 Mockery 생성</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">JMock</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PublisherTest</span> <span class="o">{</span>
    <span class="nc">Mockery</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JUnit4Mockery</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">//2. Mock 객체 만들기</span>
<span class="kd">final</span> <span class="nc">Subscriber</span> <span class="n">subscriber</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="nc">Subscriber</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">//3. 예상 동작 지정 및 테스트 수행</span>
<span class="c1">//	{{}} 가 연속적으로 사용된 것은 Anonymous 클래스로 만들어지고 있는 Expectation 클래스의 필드 부분에 멤버 블록을 만든 코드다. -&gt; 클래스가 생성과 동시에 호출됨</span>
<span class="n">context</span><span class="o">.</span><span class="na">checking</span><span class="o">(</span><span class="k">new</span> <span class="nc">Expectations</span><span class="o">()</span> <span class="o">{{</span>
    <span class="c1">//예상 동작들을 지정한다.</span>
<span class="o">}}</span>
<span class="o">);</span>

<span class="c1">//4. 예상값 지정하기</span>
<span class="n">호출횟수지정메소드</span><span class="o">(</span><span class="n">Mock_객체</span><span class="o">).</span><span class="na">Mock객체메소드</span><span class="o">(</span><span class="n">argument_지정</span><span class="o">);</span>
<span class="n">inSequence</span><span class="o">(</span><span class="n">sequence</span><span class="o">-</span><span class="n">name</span><span class="o">);</span>
<span class="n">when</span><span class="o">(</span><span class="n">state</span><span class="o">-</span><span class="n">machine</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="n">state</span><span class="o">-</span><span class="n">name</span><span class="o">));</span>
<span class="n">will</span><span class="o">(</span><span class="n">action</span><span class="o">);</span>
<span class="n">then</span><span class="o">(</span><span class="n">state</span><span class="o">-</span><span class="n">machine</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="k">new</span><span class="o">-</span><span class="n">state</span><span class="o">-</span><span class="n">name</span><span class="o">));</span>
</pre></table></code></div></div><h4 id="mockito"><span class="mr-2">Mockito</span><a href="#mockito" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>Mockito는 역사는 오래되지 않았지만 상태 기반 테스트를 지향한다는 점이 인기 요인이 되었다.</p><p>[특징]</p><ol><li>테스트 그 자체에 집중한다.<li>테스트 스텁을 만드는 것과 검증을 분리시켰다.<li>Mock 만드는 방법을 단일화했다.<li>테스트 스텁을 만들기 쉽다.<li>API가 간단하다.<li>프레임워크가 지원해주지 않으면 안되는 코드를 최대한 배제했다.<li>실패 시에 발생하는 에러추적이 깔끔하다.</ol><p>**Mockito는 EasyMock과 jMock의 단점을 보완하기 위해 나온 Mock 프레임워크라고 생각하면 된다.</p><ul><li>CreateMock : 인터페이스에 해당하는 Mock 객체를 만든다.<li>Stub : 테스트에 필요한 Mock 객체의 동작을 지정한다.<li>Exercise : 테스트 메소드 내에서 Mock 객체를 사용한다.<li>Verify : 메소드가 예상대로 호출됐는지 검증한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">//1. Mock 객체 만들기</span>
<span class="nc">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">타깃</span> <span class="n">인터페이스</span><span class="o">);</span>
<span class="nc">List</span> <span class="n">mockedList</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">//2. 예상 값 지정 : Mockito는 스텁-&gt;수행-&gt;검증으로 단순화되어 있다. 미리 예상 행동을 고민하지 않고 테스트를 수행 후 결과를 보자는 개념이다.</span>

<span class="c1">//3. 테스트에 사용할 스텁 만들기</span>
<span class="n">when</span><span class="o">(</span><span class="n">Mock_객체의_메소드</span><span class="o">).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">리턴값</span><span class="o">);</span>
<span class="n">when</span><span class="o">(</span><span class="n">Mock_객체의_메소드</span><span class="o">).</span><span class="na">thenThrow</span><span class="o">(</span><span class="n">예외</span><span class="o">);</span>

<span class="n">mockedList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"item"</span><span class="o">)</span>
<span class="n">mockedList</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="n">when</span><span class="o">(</span><span class="n">mockedList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"item"</span><span class="o">);</span>
<span class="n">when</span><span class="o">(</span><span class="n">mockedList</span><span class="o">.</span><span class="na">size</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="n">when</span><span class="o">(</span><span class="n">mockedList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">thenThrow</span><span class="o">(</span><span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">());</span>

<span class="c1">//4. 검증</span>
<span class="n">verify</span><span class="o">(</span><span class="n">Mock_객체</span><span class="o">).</span><span class="na">Mock_객체의_메소드</span><span class="o">;</span>
<span class="n">verify</span><span class="o">(</span><span class="n">Mock_객체</span><span class="o">,</span> <span class="n">호출횟수지정_메소드</span><span class="o">).</span><span class="na">Mock_객체의_메소드</span><span class="o">;</span>

<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">"item"</span><span class="o">);</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="s">"item"</span><span class="o">);</span>       <span class="c1">//times(n) : n번 호출됐는지 확인</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">2</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="n">box</span><span class="o">);</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">never</span><span class="o">()).</span><span class="na">add</span><span class="o">(</span><span class="n">car</span><span class="o">);</span>           <span class="c1">//never : 호출되지 않았어야 함</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">atLeastOnce</span><span class="o">()).</span><span class="na">removeAll</span><span class="o">();</span>  <span class="c1">//atLeastOnce : 최소 한 번은 호출됐어야 함</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">atLeast</span><span class="o">()).</span><span class="na">size</span><span class="o">();</span>           <span class="c1">//atLeast(n) : 적어도 n번은 호촐됐어야 함</span>
<span class="n">verift</span><span class="o">(</span><span class="n">mockedList</span><span class="o">,</span> <span class="n">atMost</span><span class="o">(</span><span class="mi">5</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="n">box</span><span class="o">);</span>         <span class="c1">//atMost(n) : 최대 n번 이상 호출되면 안됨</span>
</pre></table></code></div></div><p>[Mockito의 특징적인 기능]</p><ol><li>void 메소드를 Stub으로 만들기 - void 메소드에서 예외가 발생하는 경우 Stub으로 구현할 때 doThrow 메소드를 사용한다.<li>콜백으로 Stub 만들기 : thenAnswer - 특정 Mock 메소드에 대해 실제 로직을 구현하고자 할 때 콜백 기법을 사용, 권장하지 않는 방식이다.<li>실체 객체를 Stub으로 만들기 : SPY - Mockito는 실 객체도 Mock으로 만들 수 있는데 한정적으로 사용하기를 권장한다.<li>똑똑한 NULL 처리 : SMART NULLS - mock(List.class, RETURNS_SMART_NULLS);<li>행위 주도 개발(BDD) 스타일 지원 - //given, //when, //then 식의 행위 주도 개발 스타일로 테스트 케이스 작성을 지원해준다. BDDMockito를 static import한다.</ol><h3 id="44-mock-프레임워크-마무리"><span class="mr-2">4.4 Mock 프레임워크 마무리</span><a href="#44-mock-프레임워크-마무리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>[Mock 사용시 유의사항]</p><ol><li>Mock 프레임워크가 정말 필요한지 잘 따져본다.<li>투자 대비 수익이 확실할 때만 사용한다.<li>어떤 Mock 프레임워크를 사용하느냐는 핵심적인 문제가 아니다.<li>Mock은 Mock일 뿐이다. - 실제 객체가 끼어들어 왔을 때도 잘 동작하리라는 보장은 없다.</ol><p>**테스트 케이스 작성을 위한 궁극의 템플릿으로 //given(선행조건 기술), //when(기능수행), //then(결과 확인)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/book/'>BOOK</a>, <a href='/categories/tdd-%EC%8B%A4%EC%B2%9C%EB%B2%95%EA%B3%BC-%EB%8F%84%EA%B5%AC/'>TDD 실천법과 도구</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tdd/" class="post-tag no-text-decoration" >tdd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=4%EC%9E%A5+%ED%95%9C%EA%B3%84+%EB%8F%8C%ED%8C%8C%EB%A5%BC+%EC%9C%84%ED%95%9C+%EB%85%B8%EB%A0%A5%2C+Mock%EC%9D%84+%EC%9D%B4%EC%9A%A9%ED%95%9C+TDD+-+Hyeonsu+Lim&url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F4%25EC%259E%25A5-%25ED%2595%259C%25EA%25B3%2584-%25EB%258F%258C%25ED%258C%258C%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%259C-%25EB%2585%25B8%25EB%25A0%25A5%2C-Mock%25EC%259D%2584-%25EC%259D%25B4%25EC%259A%25A9%25ED%2595%259C-TDD%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=4%EC%9E%A5+%ED%95%9C%EA%B3%84+%EB%8F%8C%ED%8C%8C%EB%A5%BC+%EC%9C%84%ED%95%9C+%EB%85%B8%EB%A0%A5%2C+Mock%EC%9D%84+%EC%9D%B4%EC%9A%A9%ED%95%9C+TDD+-+Hyeonsu+Lim&u=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F4%25EC%259E%25A5-%25ED%2595%259C%25EA%25B3%2584-%25EB%258F%258C%25ED%258C%258C%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%259C-%25EB%2585%25B8%25EB%25A0%25A5%2C-Mock%25EC%259D%2584-%25EC%259D%25B4%25EC%259A%25A9%25ED%2595%259C-TDD%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F4%25EC%259E%25A5-%25ED%2595%259C%25EA%25B3%2584-%25EB%258F%258C%25ED%258C%258C%25EB%25A5%25BC-%25EC%259C%2584%25ED%2595%259C-%25EB%2585%25B8%25EB%25A0%25A5%2C-Mock%25EC%259D%2584-%25EC%259D%25B4%25EC%259A%25A9%25ED%2595%259C-TDD%2F&text=4%EC%9E%A5+%ED%95%9C%EA%B3%84+%EB%8F%8C%ED%8C%8C%EB%A5%BC+%EC%9C%84%ED%95%9C+%EB%85%B8%EB%A0%A5%2C+Mock%EC%9D%84+%EC%9D%B4%EC%9A%A9%ED%95%9C+TDD+-+Hyeonsu+Lim" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="Limhyeonsu/Limhyeonsu.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/15.Top-N%EC%BF%BC%EB%A6%AC/">15. Top-N 쿼리</a><li><a href="/posts/09.%EB%A9%B4%EC%A0%91%EB%AC%B8%EC%A0%9C/">09. 면접문제</a><li><a href="/posts/14.%EB%B6%84%EC%84%9D%ED%95%A8%EC%88%98/">14. 분석함수</a><li><a href="/posts/07.%EA%B8%B0%EC%88%A0%EC%A0%81-%EB%AC%B8%EC%A0%9C/">07. 기술적 문제</a><li><a href="/posts/06.bigO/">06. big-O</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/1%EC%9E%A5-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C/"><div class="card-body"> <em class="timeago small" data-ts="1651581016" > 2022-05-03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>1장 테스트 주도 개발</h3><div class="text-muted small"><p> 1.1 흔하디 흔한 소프트웨어 개발 방식 전통적인 소프트웨어 개발 방식에서는 문제가 발생하고, 문제를 해결하고, 검증을 위한 테스트를 진행시 대표적으로 ‘콘솔’ 화면에 값을 찍어보는 방식을 사용했다. 대개 이런 경우 작성된 코드의 문제 유무 판단을 개발자 자신의 두뇌에 상당 부분 의존하게 된다. 이러한 전통적인 개발 및 테스트에서는 다음의 문제들을 ...</p></div></div></a></div><div class="card"> <a href="/posts/2%EC%9E%A5-JUnit%EA%B3%BC-Hamcrest/"><div class="card-body"> <em class="timeago small" data-ts="1651818452" > 2022-05-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2장 JUnit과 Hamcrest</h3><div class="text-muted small"><p> 2.1 JUnit JUnit은 현재 전 세계적으로 가장 널리 사용되는 Java 단위 테스트 프레임워크이다. 기본적으로 다음과 같은 기능을 제공한다. 테스트 결과가 예상과 같은지를 판별해주는 단정문 여러 테스트에서 공용으로 사용할 수 있는 테스트 픽스처 테스트 작업을 수행할 수 있게 해주는 테스트 러너 꼭 알아두어야할 개념으로 테스트 픽...</p></div></div></a></div><div class="card"> <a href="/posts/3%EC%9E%A5-TDD-%EC%A2%80-%EB%8D%94-%EC%9E%98%ED%95%98%EA%B8%B0/"><div class="card-body"> <em class="timeago small" data-ts="1652061152" > 2022-05-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>3장 TDD 좀 더 잘하기</h3><div class="text-muted small"><p> 3.1 테스트 케이스 클래스의 위치 단위 테스트 케이스를 소스 구조 안에서 어디에 놓을 것인지 결정해야 한다. 1)테스트 대상 소스와 테스트 클래스를 같은 곳에 테스트 클래스와 같은 패키지 내에 놓는 가장 기본적인 형태이다. 간단한 테스트 생성시 외에 사용하지 않는다. 2)테스트 클래스는 하위 패키지로 예) src/bank - 제품코드 클래스,...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/3%EC%9E%A5-TDD-%EC%A2%80-%EB%8D%94-%EC%9E%98%ED%95%98%EA%B8%B0/" class="btn btn-outline-primary" prompt="Older"><p>3장 TDD 좀 더 잘하기</p></a> <a href="/posts/5%EC%9E%A5-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%85%8C%EC%8A%A4%ED%8A%B8-DbUnit/" class="btn btn-outline-primary" prompt="Newer"><p>5장 데이터베이스 테스트 DbUnit</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
