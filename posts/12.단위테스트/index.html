<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="단위 테스트" /><meta property="og:locale" content="en" /><meta name="description" content="구글에서 말하는 단위 테스트는 단일 클래스나 메서드처럼 범위가 상대적으로 좁은 테스트를 뜻한다." /><meta property="og:description" content="구글에서 말하는 단위 테스트는 단일 클래스나 메서드처럼 범위가 상대적으로 좁은 테스트를 뜻한다." /><link rel="canonical" href="https://limhyeonsu.github.io/posts/12.%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8/" /><meta property="og:url" content="https://limhyeonsu.github.io/posts/12.%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8/" /><meta property="og:site_name" content="Hyeonsu Lim" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-04T22:01:18+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="단위 테스트" /><meta name="twitter:site" content="@imhyeon99494867" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-06T19:52:37+09:00","datePublished":"2022-11-04T22:01:18+09:00","description":"구글에서 말하는 단위 테스트는 단일 클래스나 메서드처럼 범위가 상대적으로 좁은 테스트를 뜻한다.","headline":"단위 테스트","mainEntityOfPage":{"@type":"WebPage","@id":"https://limhyeonsu.github.io/posts/12.%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8/"},"url":"https://limhyeonsu.github.io/posts/12.%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8/"}</script><title>12. 단위 테스트 | Hyeonsu Lim</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hyeonsu Lim"><meta name="application-name" content="Hyeonsu Lim"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile_img.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hyeonsu Lim</a></div><div class="site-subtitle font-italic">Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Limhyeonsu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/imhyeon99494867" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gustn72096','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>12. 단위 테스트</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>12. 단위 테스트</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1667566878" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-11-04 </em> </span> <span> Updated <em class="timeago" data-ts="1667731957" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-11-06 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5377 words"> <em>29 min</em> read</span></div></div></div><div class="post-content"><p>구글에서 말하는 단위 테스트는 단일 클래스나 메서드처럼 범위가 상대적으로 좁은 테스트를 뜻한다.</p><p>테스트의 가장 중요한 목적은 버그 예방이다. 그 다음으로는 엔지니어의 생산성 개선이 있다. 범위가 넓은 테스트와 비교했을 때 단위 테스트는 생산성을 끌어올리는 훌륭한 수단이 될 수 있다.</p><ul><li>단위 테스트는 대체로 작은 테스트에 속한다. 작은 테스트는 빠르고, 결정적이여서 수시로 수행하여 즉각적인 피드백을 받을 수 있다.<li>단위 테스트는 작성하기 쉽다.<li>빠르게 작성할 수 있어 테스트 커버리지를 높이기 좋다. 기존 동작을 망가뜨리지 않으리라는 확신 속에서 코드를 변경할 수 있다.<li>실패시 원인을 파악하기 쉽다.<li>대상 시스템의 사용법과 의도한 동작 방식을 알려주는 문서자료 혹은 예제 코드 역할을 해준다.</ul><p>단위 테스트는 일상에서 비중이 크기 때문에 구글은 테스트 유지보수성을 상당히 중시한다. 유지보수하기 쉬운 테스트란 한 번 작성해두면 실패하지 않는 한 엔지니어가 신경 쓸 필요없고, 실패한다면 원인을 바로 알 수 있는 진짜 버그를 찾았다는 뜻이다.</p><h2 id="121-유지보수하기-쉬워야-한다"><span class="mr-2">12.1 유지보수하기 쉬워야 한다.</span><a href="#121-유지보수하기-쉬워야-한다" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>주변에서 흔히 목격되는 테스트 작성의 문제의 원인으로</p><ol><li>버그도 없고 자신의 검증 대상과 관련없는 변경 때문에 실패하는 깨지기 쉬운 테스트들이 도사리고 있다.<li>무엇이 잘못되어 실패했는지 어떻게 고쳐야 하는지 파악하기 어려운 불명확한 테스트들이다.</ol><h2 id="122-깨지기-쉬운-테스트-예방하기"><span class="mr-2">12.2 깨지기 쉬운 테스트 예방하기</span><a href="#122-깨지기-쉬운-테스트-예방하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>깨지기 쉬운 테스트란 실제로는 버그가 없음에도, 검증 대상 코드와는 관련조차 없는 변경 때문에 실패하는 테스트를 말한다. 이러한 테스트는 엔지니어가 직접 진단하고 수정해야 한다.</p><h3 id="1221-변하지-않는-테스트로-만들기-위해-노력하자"><span class="mr-2">12.2.1 변하지 않는 테스트로 만들기 위해 노력하자</span><a href="#1221-변하지-않는-테스트로-만들기-위해-노력하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>기본적인 변경 유형은 다음과 같다.</p><ul><li>순수 리팩터링 - 외부 인터페이스는 놔두고 내부만 리팩터링 하는 경우 테스트는 변경되지 않아야 한다. 리팩터링 과정에서 테스트를 변경해야 한다면 원인은 1)시스템의 행위가 달라졌다, 2)테스트의 추상화 수준이 적절하지 않았다.<li>새로운 기능 추가 - 새로운 기능이나 행위를 추가할 때는 기존 행위들에 영향을 주지 않아야 한다. 기존 테스트를 변경해야 한다면 해당 테스트가 검증하는 기능에 의도치 않은 영향을 주었거나 테스트 자체에 문제가 있다는 뜻이다.<li>버그 수정 - 버그 수정은 새로운 기능 추가와 비슷하다.<li>행위 변경 - 시스템의 기존 행위를 변경하는 경우로 기존 테스트 역시 변경되어야 한다.</ul><p><code class="language-plaintext highlighter-rouge">리팩터링, 새 기능 추가, 버그수정</code>시에는 기존 테스트를 손볼 일이 없어야 한다.</p><h3 id="1222-공개-api를-이용해-테스트하자"><span class="mr-2">12.2.2 공개 API를 이용해 테스트하자</span><a href="#1222-공개-api를-이용해-테스트하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>테스트가 시스템을 사용자와 똑같은 방식으로 사용하게 하면 테스트가 실패한 경우 사용자도 똑같은 문제를 겪는다. 그렇게 되면 테스트가 사용자에게 유용한 예제 코드와 문서자료가 되어준다는 이점을 얻을 수 있다.</p><p>어디까지가 공개 API냐가 항상 명확한 것은 아니며 이는 단위 테스트에서 말하는 단위가 무엇이냐를 규정하는 핵심적인 질문으로 이어진다. 이런 맥락에서 공개 API란 이런 단위의 코드 소유자가 서드파티에 노출한 API를 뜻한다.(??)</p><p>어디까지가 공개 API인가를 정하는 일에 정답은 없지만 경험법칙으로 다음과 같이 있다.</p><ul><li>소수의 다른 클래스를 보조하는 용도가 다인 메서드나 클래스는 직접 테스트하지 말고 이들을 보조하는 클래스를 통해 우회적으로 테스트해야 한다.<li>소유자의 통제 없이 누구든 접근할 수 있게 설계된 패키지나 클래스라면 예외없이 직접 테스트해야하는 단위로 취급해야 한다.<li>소유자만이 접근할 수 있지만 다방면으로 유용한 기능을 제공하도록 설계된 패키지나 클래스 역시 직접 테스트해야 하는 단위로 본다.</ul><h3 id="1223-상호작용이-아니라-상태를-테스트하자"><span class="mr-2">12.2.3 상호작용이 아니라 상태를 테스트하자</span><a href="#1223-상호작용이-아니라-상태를-테스트하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>시스템이 기대한대로 동작하는지 검증하는 방법으로 다음과 같이 있다.</p><ol><li>상태 테스트 - 메서드 호출 후 시스템 자체를 관찰한다.<li>상호작용 테스트 - 호출을 처리하는 과정에서 시스템이 다른 모듈들과 협력해서 기대한 일련의 동작을 수행하는지를 확인한다.</ol><p>대체로 상호작용 테스트가 상태 테스트보다 깨지기 쉽다. 우리가 원하는 것은 결과가 무엇이냐 이지만, 상호작용 테스트는 결과에 도달하기까지 시스템이 어떻게 작동하냐를 확인하려 들기 때문이다.</p><p>잠재적으로 문제가 될 수 있는 상호작용 테스트가 만들어지는 가장 큰 원인은 바로 모의 객체 프레임워크에 지나치게 의존하기 때문이다. 모의 객체 프레임워크를 이용하면 테스트 대역을 만들기 쉽고, 이는 자신을 향한 모든 호출을 기록하고 검증할 수 있게 해준다. 이러한 편리함에 엔지니어들에게 깨지기 쉬운 상호작용 테스트를 만들도록 유혹한다.</p><p>그래서 우리는 진짜 객체가 빠르고 결정적이라면 진짜 객체를 사용해야 한다.</p><h2 id="123-명확한-테스트-작성하기"><span class="mr-2">12.3 명확한 테스트 작성하기</span><a href="#123-명확한-테스트-작성하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>깨지기 쉬운 요소를 제거했더라도 언젠가는 테스트가 실패한다. 실패하는 이유로는</p><ol><li>대상 시스템에 문제가 있거나 불완전한 경우<li>테스트 자체에 결함이 있는 경우</ol><p>테스트 실패의 이유를 얼마나 빠르게 찾느냐는 테스트 명확성에 달려있다. <strong>명확한 테스트는 존재 이유와 실패 원인을 엔지니어가 곧바로 알아차릴 수 있는 테스트를 말한다.</strong> 명확한 테스트는 대상 시스템의 문서자료 역할을 해주고, 새로운 테스트를 작성하기 쉽게 도와주는 토대가 되어주는 등의 이점도 제공한다.</p><p>제품의 코드가 명확하지 않은 문제와는 다르다. 대체로 제품 코드는 해당 코드를 제거했을 때 어디에 문제가 생기는지나 호출 관계 등을 파헤쳐보면 비교적 쉽게 목적을 알아낼 수 있다. 반면 불명확한 테스트는 목적을 결코 알아내지 못할 가능성도 크다.</p><h3 id="1231-완전하고-간결하게-만들자"><span class="mr-2">12.3.1 완전하고 간결하게 만들자</span><a href="#1231-완전하고-간결하게-만들자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>완전하고 간결성은 테스트를 명확하게 만드는 데 도움이 되는 거시적인 특성이다. 완전한 테스트는 결과에 도달하기까지의 논리를 읽는 이가 이해하는 데 필요한 모든 정보를 본문에 담고 있는 테스트를 말한다. 간결한 테스트는 코드가 산만하지 않고 관련 없는 정보는 포함하지 않는 테스트이다.</p><p>[두 특성 중 어느 것도 갖추지 못한 안 좋은 테스트 예]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldPerformAddition</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">//Calculator 생성자에서 관련 없는 정보를 잔뜩 받고 있다.</span>
  <span class="nc">Calculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calculator</span><span class="o">(</span><span class="k">new</span> <span class="nc">RoundingStrategy</span><span class="o">(),</span> <span class="s">"unused"</span><span class="o">,</span> <span class="no">ENABLE_COSINE_FEATURE</span><span class="o">,</span> <span class="mf">0.01</span><span class="o">,</span> <span class="n">calculusEngine</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

  <span class="c1">//중요한 부분은 도우미 메서드인 newTestCalculation에 숨겨져 있다.</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="na">calculate</span><span class="o">(</span><span class="n">newTestCalculation</span><span class="o">());</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="na">isEqualsTo</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>[완전하고 간결한 테스트]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldPerformAddition</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Calculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Calculator</span><span class="o">();</span>
  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="na">calculate</span><span class="o">(</span><span class="n">newCalculation</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Operation</span><span class="o">.</span><span class="na">PLUS</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="na">isEqualsTo</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="1232-메서드가-아니라-행위를-테스트하자"><span class="mr-2">12.3.2 메서드가 아니라 행위를 테스트하자</span><a href="#1232-메서드가-아니라-행위를-테스트하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>많은 엔지니어가 본능적으로 테스트의 구조를 대상 코드의 구조와 일치시키려고 한다. (제품 코드의 메서드 하나에 테스트 메서드도 하나씩 두는 식으로) 이렇게 되면 대상 메서드가 복잡해질수록 테스트도 함께 복잡해져서 실패해도 원인을 파악하기 어려워진다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">displayTransactionResult</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nc">Transaction</span> <span class="n">transaction</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ui</span><span class="o">.</span><span class="na">showMessage</span><span class="o">(</span><span class="n">transaction</span><span class="o">.</span><span class="na">getItemName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"을(를) 구입하셨습니다."</span><span class="o">);</span>
  <span class="k">if</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getBalance</span><span class="o">()</span> <span class="o">&lt;</span> <span class="no">LOW_BALANCE_THRESHOLD</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ui</span><span class="o">.</span><span class="na">showMessage</span><span class="o">(</span><span class="s">"잔고가 부족합니다!"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>[메서드 중심 테스트]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDisplayTransactionResult</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">transactionProcessor</span><span class="o">.</span><span class="na">displayTransactionResult</span><span class="o">(</span><span class="n">newUserWithBalance</span><span class="o">(</span><span class="no">LOW_BALANCE_THRESHOLD</span><span class="o">.</span><span class="na">plus</span><span class="o">(</span><span class="n">dollars</span><span class="o">(</span><span class="mi">2</span><span class="o">))),</span> <span class="k">new</span> <span class="nc">Transaction</span><span class="o">(</span><span class="s">"물품"</span><span class="o">,</span> <span class="n">dollers</span><span class="o">(</span><span class="mi">3</span><span class="o">)));</span>

  <span class="n">assertThat</span><span class="o">(</span><span class="n">ui</span><span class="o">.</span><span class="na">getText</span><span class="o">()).</span><span class="na">contains</span><span class="o">(</span><span class="s">"물품을(를) 구입하셨습니다."</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">ui</span><span class="o">.</span><span class="na">getText</span><span class="o">()).</span><span class="na">contains</span><span class="o">(</span><span class="s">"잔고가 부족합니다!"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>[행위 주도 테스트]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDisplayTransactionResult_showsItemName</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">transactionProcessor</span><span class="o">.</span><span class="na">displayTransactionResult</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Transacion</span><span class="o">(</span><span class="s">"물품"</span><span class="o">));</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">ui</span><span class="o">.</span><span class="na">getText</span><span class="o">()).</span><span class="na">contains</span><span class="o">(</span><span class="s">"물품을(를) 구입하셨습니다."</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDisplayTransactionResult_showLowBalanceMarning</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">transactionProcessor</span><span class="o">.</span><span class="na">displayTransactionResult</span><span class="o">(</span>
          <span class="n">newUserWithBalance</span><span class="o">(</span><span class="no">LOW_BALANCE_THRESHOLD</span><span class="o">.</span><span class="na">plus</span><span class="o">(</span><span class="n">dollars</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
          <span class="o">),</span> <span class="k">new</span> <span class="nc">Transaction</span><span class="o">(</span><span class="s">"물품"</span><span class="o">,</span> <span class="n">dollers</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span>
          <span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">ui</span><span class="o">.</span><span class="na">getText</span><span class="o">()).</span><span class="na">contains</span><span class="o">(</span><span class="s">"잔고가 부족합니다!"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>테스트를 쪼개느라 코드가 늘어났지만 각 테스트가 명확하게 되었으니 결과적으로 그 이상의 값어치를 한 것이다. 행위 주도 테스트는 대체로 메서드 중심 테스트보다 명확하다. 이유는</p><ol><li>자연어에 더 가깝게 읽히기 때문에 힘들여 분석하지 않아도 자연스럽게 이해할 수 있다.<li>테스트 각각이 더 좁은 범위를 검사하기 때문에 원인과 결과가 더 분명하게 드러난다.<li>각 테스트가 짧고 서술적이어서 이미 검사한 기능이 무엇인지 더 쉽게 확인할 수 있다.</ol><h4 id="테스트의-구조는-행위가-부각되도록-구성하자"><span class="mr-2">테스트의 구조는 행위가 부각되도록 구성하자</span><a href="#테스트의-구조는-행위가-부각되도록-구성하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>모든 행위는 given, when, then 이라는 세 요소로 구성됨을 기억하자</p><ul><li>given - 시스템의 설정을 정의 (예. 은행 잔고가 빈 상태에서)<li>when - 시스템이 수행할 작업을 정의 (예. 돈을 인출하려 하면)<li>then - 결과를 검증 (예. 거래를 거부한다.)</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">transferFundsShouldMoveMoneyBetweenAccount</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">//given 두 개의 계좌, 각각의 잔고는 150과 20</span>
  <span class="nc">Account</span> <span class="n">account1</span> <span class="o">=</span> <span class="n">newAccountWithBalacve</span><span class="o">(</span><span class="n">usd</span><span class="o">(</span><span class="mi">150</span><span class="o">));</span>
  <span class="nc">Account</span> <span class="n">account2</span> <span class="o">=</span> <span class="n">newAccountWithBalacve</span><span class="o">(</span><span class="n">usd</span><span class="o">(</span><span class="mi">20</span><span class="o">));</span>

  <span class="c1">//when 첫 번째 계좌에서 두 번째 계좌로 100 이체</span>
  <span class="n">bank</span><span class="o">.</span><span class="na">transferFunds</span><span class="o">(</span><span class="n">account1</span><span class="o">,</span> <span class="n">account2</span><span class="o">,</span> <span class="n">usd</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>

  <span class="c1">//then 각 계좌 잔고에 이체결과 반영</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">account1</span><span class="o">.</span><span class="na">getBalance</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">usd</span><span class="o">(</span><span class="mi">50</span><span class="o">));</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">account2</span><span class="o">.</span><span class="na">getBalance</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">usd</span><span class="o">(</span><span class="mi">120</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p>여러 단계로 진행되는 작업을 단계별로 검증하고 싶을 때는 when과 then 블록을 교대로 정의하는 방법도 있다. 이런 테스트를 작성할 때는 <strong>동시에 여러 행위를 검사하는 실수를 범하지 않도록 주의해야 한다.</strong> <code class="language-plaintext highlighter-rouge">테스트 각각은 단 하나의 행위만 다뤄야 한다.</code></p><h4 id="테스트-이름은-검사하는-행위에-어울리게-짓자"><span class="mr-2">테스트 이름은 검사하는 행위에 어울리게 짓자</span><a href="#테스트-이름은-검사하는-행위에-어울리게-짓자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>메서드 중심 테스트들의 이름은 대체로 대상 메서드의 이름을 따서 짓는다. 반면 행위 주도 테스트에서는 이름 짓기가 더 자유롭기 때문에 더 의미 있는 정보를 담을 수 있다.</p><p>테스트의 이름은 <strong>검사하려는 행위를 요약해 보여줘야 한다. 시스템이 수행하는 동작과 예상 결과를 모두 담아야</strong> 좋은 이름이다.</p><p>메서드 이름에 전부 녹이게 되면 상당히 상세하고 길어진다. 제품에 들어갈 코드였다면 추천하지 않지만 우리는 이 메서드를 호출하는 코드를 작성할 일이 없다. 대신 이 이름들을 주로 보고서에 담겨서 사람에게 전달될 것이다.</p><h3 id="1233-테스트에-논리를-넣지-말자"><span class="mr-2">12.3.3 테스트에 논리를 넣지 말자</span><a href="#1233-테스트에-논리를-넣지-말자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>복잡성은 대체로 논리라는 형태로 나타난다. 논리는 프로그래밍 언어에서 명령형 요소(연산자, 반복문, 조건문 등)를 이용해 표현한다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">//논리가 버그를 감추는 예</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldNavigateToAlbumsPage</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">baseUrl</span> <span class="o">=</span> <span class="s">"http://photos.google.com/"</span><span class="o">;</span>
  <span class="nc">Navigator</span> <span class="n">nav</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Navigator</span><span class="o">(</span><span class="n">baseUrl</span><span class="o">);</span>
  <span class="n">nav</span><span class="o">.</span><span class="na">goToAlbumPage</span><span class="o">();</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">nav</span><span class="o">.</span><span class="na">getCurrentUrl</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">baseUrl</span> <span class="o">+</span> <span class="s">"/albums"</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldNavigateToAlbumsPage</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Navigator</span> <span class="n">nav</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Navigator</span><span class="o">(</span><span class="nl">http:</span><span class="c1">//photos.google.com/);</span>
  <span class="n">nav</span><span class="o">.</span><span class="na">goToAlbumPage</span><span class="o">();</span>

  <span class="c1">//전체 문자열을 적어주자 URL에 슬래시를 두 번 썼음이 바로 드러났다.</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">nav</span><span class="o">.</span><span class="na">getCurrentUrl</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"http://photos.google.com//albums"</span><span class="o">);</span> <span class="c1">// ???</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 예처럼 단순한 문자열 연결에서도 버그를 잡아내기 쉽지 않은데 반복문이나 조건문처럼 더 복잡한 로직이 들어갔다면 말할 것도 없다. <code class="language-plaintext highlighter-rouge">테스트 코드에서는 스마트한 로직보다 직설적인 코드를 고집해야 한다.</code> 또 서술적이고 의미 있는 테스트를 만들기 위한 약간의 중복은 허용하는 것이 좋다.</p><h3 id="1234-실패-메시지를-명확하게-작성하자"><span class="mr-2">12.3.4 실패 메시지를 명확하게 작성하자</span><a href="#1234-실패-메시지를-명확하게-작성하자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>실무에서는 테스트 실패 보고서나 로그에 찍힌 메시지 한 줄로만 문제의 원인을 찾아야 할 때가 많다. 잘 작성된 실패 메시지라면 테스트의 이름과 거의 동일한 정보를 담고 있어야 한다. <code class="language-plaintext highlighter-rouge">원하는 결과, 실제 결과, 이때 건네진 매개변수의 값</code>을 명확히 알려줘야 한다.</p><h2 id="124-테스트와-코드-공유-dry가-아니라-damp"><span class="mr-2">12.4 테스트와 코드 공유: DRY가 아니라 DAMP!</span><a href="#124-테스트와-코드-공유-dry가-아니라-damp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>테스트를 명확하고 잘 깨지지 않게 해주는 마지막 요인은 코드 공유라는 주제와 관련이 있다. 대부분의 소프트웨어는 반복하지 말라는 뜻의 DRY 원칙을 숭배한다.</p><p>DRY는 개념들을 각각 독립된 하나의 장소에서 구현하여 코드 중복을 최소로 줄이면 유지보수하기 더 쉽다고 말한다. 이 원칙대로 한다면 참조에 참조를 따라야 실제 로직을 구현한 코드를 찾아 분석할 수 있기 때문에 코드 명확성이 떨어진다는 단점도 생긴다.</p><p>좋은 테스트는 안정적이고, 대상 시스템의 행위가 변경되면 실패하도록 설계된다. 따라서 테스트코드에서는 DRY가 주는 혜택이 그리 크지 않다. 테스트 코드는 DRY를 고집하는 대신, DAMP가 되도록 노력해야 한다. DAMP는 ‘서술적이고 의미 있는 문구’를 뜻한다. 단순하고 명료하게만 만들어준다면 테스트에서 다소의 중복은 괜찮다.</p><p><code class="language-plaintext highlighter-rouge">테스트에서의 리팩터링은 반복을 줄이는 게 아니라 더 서술적이고 의미 있게 하는 방향으로 이루어져야 한다.</code></p><h3 id="1241-공유-값"><span class="mr-2">12.4.1 공유 값</span><a href="#1241-공유-값" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>[이름이 모호한 공유 값]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Account</span> <span class="no">ACCOUNT_1</span> <span class="o">=</span> <span class="nc">Account</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">setState</span><span class="o">(</span><span class="nc">AccountState</span><span class="o">.</span><span class="na">OPEN</span><span class="o">).</span><span class="na">setBalance</span><span class="o">(</span><span class="mi">50</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Account</span> <span class="no">ACCOUNT_2</span> <span class="o">=</span> <span class="nc">Account</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">setState</span><span class="o">(</span><span class="nc">AccountState</span><span class="o">.</span><span class="na">CLOSED</span><span class="o">).</span><span class="na">setBalance</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Item</span> <span class="no">ITEM</span> <span class="o">=</span> <span class="nc">Item</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">setName</span><span class="o">(</span><span class="s">"치즈버거"</span><span class="o">).</span><span class="na">setPrice</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// 수백 줄의 다른 테스트들....</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">canBuyItem_returnsFalseForCloserdAccounts</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">store</span><span class="o">.</span><span class="na">canBuyItem</span><span class="o">(</span><span class="no">ITEM</span><span class="o">,</span> <span class="no">ACCOUNT_1</span><span class="o">)).</span><span class="na">isFalse</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">canBuyItem_returnsFalseWhenBalanceInsufficient</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">store</span><span class="o">.</span><span class="na">canBuyItem</span><span class="o">(</span><span class="no">ITEM</span><span class="o">,</span> <span class="no">ACCOUNT_2</span><span class="o">)).</span><span class="na">isFalse</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 예는 테스트 스위트가 커질수록 문제가 된다. 각 테스트에서 왜 그 값을 선택했는지를 이해하기 어렵다.</p><p>다음의 예는 도우미 메서드를 이용하여 데이터를 구성하는 방법을 사용한다. 테스트 작성자가 필요한 값들만 명시해 도우미 메서드에 요청하면 그 외 값들에는 적절한 기본값을 설정해 돌려준다.</p><p>[도우미 메서드를 사용해 값을 공유하는 예]</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c1">// 도우미 메서드는 각 매개변수에 임의의 기본 값을 정의하여 생성지를 래핑한다.</span>
<span class="n">def</span> <span class="nf">newContact</span><span class="o">(</span><span class="n">firstName</span> <span class="o">=</span> <span class="s">"Grace"</span><span class="o">,</span> <span class="n">lastName</span><span class="o">=</span><span class="s">"Hopper"</span><span class="o">,</span> <span class="n">phoneNumber</span><span class="o">=</span><span class="s">"555-123-4567"</span><span class="o">):</span>
  <span class="k">return</span> <span class="nf">Contact</span><span class="o">(</span><span class="n">firstName</span><span class="o">,</span> <span class="n">lastName</span><span class="o">,</span> <span class="n">phoneNumber</span><span class="o">)</span>

<span class="c1">// 테스트는 필요한 매개변수의 값만 설정하여 도우미를 호출한다.</span>
<span class="n">def</span> <span class="nf">test_fullNameShouldCombineFirstAndLastNames</span><span class="o">(</span><span class="n">self</span><span class="o">):</span>
  <span class="n">def</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">newContact</span><span class="o">(</span><span class="n">firstName</span><span class="o">=</span><span class="s">"에이다"</span><span class="o">,</span> <span class="n">lastName</span><span class="o">=</span><span class="s">"러브레이스"</span><span class="o">)</span>
  <span class="n">self</span><span class="o">.</span><span class="na">assertEqual</span><span class="o">(</span><span class="n">contact</span><span class="o">.</span><span class="na">fullName</span><span class="o">(),</span> <span class="s">"에이다 러브레이스"</span><span class="o">)</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="nc">Contact</span><span class="o">.</span><span class="na">Builder</span> <span class="nf">newContact</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Contact</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"그레이스"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"호퍼"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setPhoneNumber</span><span class="o">(</span><span class="s">"555-123-4567"</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">fullNameShouldConbineFirstAndLastNames</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">newContact</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="s">"에이다"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="s">"러브레이스"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

  <span class="n">assertThat</span><span class="o">(</span><span class="n">contact</span><span class="o">.</span><span class="na">getFullName</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"에이다 러브레이스"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이처럼 도우미 메서드를 이용하면 불필요한 정보로 오염되거나 다른 테스트와 출돌할 염려 없이 정확히 필요한 값들만 생성해 사용할 수 있다.</p><h3 id="1242-공유-셋업"><span class="mr-2">12.4.2 공유 셋업</span><a href="#1242-공유-셋업" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>테스트 각각을 수행하기 직전에 실행되는 메서드를 정의할 수 있게 해주는 것을 ‘셋업’ 메서드라고 한다 셋업 메서드는 대상 객체와 협력 객체들을 생성하는 데 매우 유용하다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">//셋업 메서드에서 사용한 값에 의존</span>
<span class="nd">@Before</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">nameService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NameService</span><span class="o">();</span>
  <span class="n">nameService</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"user1"</span><span class="o">,</span> <span class="s">"도널드 커누스"</span><span class="o">);</span>
  <span class="n">userStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserStore</span><span class="o">(</span><span class="n">nameService</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">//.....</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldReturnNameFromService</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">UserDetails</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userStore</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"user1"</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"도널드 커누스"</span><span class="o">);</span>
<span class="o">}</span>


<span class="c1">//셋업 메서드에서 사용한 값을 덮어씀</span>
<span class="nd">@Before</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">nameService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NameService</span><span class="o">();</span>
  <span class="n">nameService</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"user1"</span><span class="o">,</span> <span class="s">"도널드 커누스"</span><span class="o">);</span>
  <span class="n">userStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserStore</span><span class="o">(</span><span class="n">nameService</span><span class="o">)</span><span class="n">l</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldReturnNameFromService</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">nameService</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"user1"</span><span class="o">,</span> <span class="s">"마거릿 해밀턴"</span><span class="o">);</span>
  <span class="nc">UserDetails</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userStore</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"user1"</span><span class="o">);</span>
  <span class="n">assertThat</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"마거릿 해밀턴"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="1243-공유-도우미-메서드와-공유-검증-메서드"><span class="mr-2">12.4.3 공유 도우미 메서드와 공유 검증 메서드</span><a href="#1243-공유-도우미-메서드와-공유-검증-메서드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>도우미 메서드를 이용하면 테스트용 값을 생성하는 코드가 간결해진다. 하지만 모든 테스트가 마지막에 도우미 메서드를 호출하는 극단적인 상황은 위험한 습관이다.</p><p>하나의 목적에 집중하는 검증 메서드는 유용하다. 검증용 도우미 메서드는 여러 조건을 확인하는 게 아니라 <code class="language-plaintext highlighter-rouge">입력에 대한 단 하나의 개념적 사실만을 검증한다.</code></p><h3 id="1244-테스트-인프라-정의하기"><span class="mr-2">12.4.4 테스트 인프라 정의하기</span><a href="#1244-테스트-인프라-정의하기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>가끔은 테스트 스위트와도 코드를 공유하면 유용할 때가 있다. 구글은 이런 종류의 코드를 테스트 인프라라고 부른다. 테스트 인프라는 주로 통합 테스트나 종단간 테스트 때 빛을 발한다.</p><p>테스트 인프라는 단일 테스트 스위트 안에서의 코드 공유보다 훨씬 신중하게 접근해야 한다. 테스트 인프라는 많은 곳에서 호출되는 만큼 이에 의존하는 코드가 많다. 그래서 동작이 달라지면 다른 코드들이 깨지기 때문에 변경하기도 어렵다.</p><h2 id="125-마치며"><span class="mr-2">12.5 마치며</span><a href="#125-마치며" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>단위 테스트는 예기치 못한 변경에도 시스템이 오래도록 잘 구동되게끔 보증하기 위해 소프트웨어 엔지니어가 할 수 있는 가장 강력한 도구에 속한다. 하지만 단위 테스트를 생각 없이 만들면 시스템에 대한 확신을 키워주는 건 고사하고 시스템을 유지보수하거나 변경하기가 훨씬 어려워 진다.</p><h2 id="126-핵심-정리"><span class="mr-2">12.6 핵심 정리</span><a href="#126-핵심-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>변하지 않는 테스트를 만들기 위해 노력하자<li>공개 API를 통해 테스트하자<li>상호작용이 아닌 상태를 테스트하자<li>테스트를 완전하고 명확하게 만들라<li>메서드가 아닌 행위를 테스트하라<li>행위가 부각되게끔 테스트를 구성하라<li>테스트 이름은 검사하는 행위가 잘 드러나게 지으라<li>테스트에 로직을 넣지 말라<li>실패 메시지를 명확하게 작성하라<li>테스트들이 코드를 공유할 때는 DRY 보다 DAMP를 우선하자</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/book/'>BOOK</a>, <a href='/categories/%EA%B5%AC%EA%B8%80-%EC%97%94%EC%A7%80%EB%8B%88%EC%96%B4%EB%8A%94-%EC%9D%B4%EB%A0%87%EA%B2%8C-%EC%9D%BC%ED%95%9C%EB%8B%A4/'>구글 엔지니어는 이렇게 일한다</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/software-engineering/" class="post-tag no-text-decoration" >software_engineering</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=12.+%EB%8B%A8%EC%9C%84+%ED%85%8C%EC%8A%A4%ED%8A%B8+-+Hyeonsu+Lim&url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F12.%25EB%258B%25A8%25EC%259C%2584%25ED%2585%258C%25EC%258A%25A4%25ED%258A%25B8%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=12.+%EB%8B%A8%EC%9C%84+%ED%85%8C%EC%8A%A4%ED%8A%B8+-+Hyeonsu+Lim&u=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F12.%25EB%258B%25A8%25EC%259C%2584%25ED%2585%258C%25EC%258A%25A4%25ED%258A%25B8%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F12.%25EB%258B%25A8%25EC%259C%2584%25ED%2585%258C%25EC%258A%25A4%25ED%258A%25B8%2F&text=12.+%EB%8B%A8%EC%9C%84+%ED%85%8C%EC%8A%A4%ED%8A%B8+-+Hyeonsu+Lim" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="Limhyeonsu/Limhyeonsu.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/15.Top-N%EC%BF%BC%EB%A6%AC/">15. Top-N 쿼리</a><li><a href="/posts/09.%EB%A9%B4%EC%A0%91%EB%AC%B8%EC%A0%9C/">09. 면접문제</a><li><a href="/posts/14.%EB%B6%84%EC%84%9D%ED%95%A8%EC%88%98/">14. 분석함수</a><li><a href="/posts/07.%EA%B8%B0%EC%88%A0%EC%A0%81-%EB%AC%B8%EC%A0%9C/">07. 기술적 문제</a><li><a href="/posts/06.bigO/">06. big-O</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/01.%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%97%94%EC%A7%80%EB%8B%88%EC%96%B4%EB%A7%81%EC%9D%B4%EB%9E%80/"><div class="card-body"> <em class="timeago small" data-ts="1665758402" > 2022-10-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>01. 소프트웨어 엔지니어링이란?</h3><div class="text-muted small"><p> 프로그래밍과 소프트웨어 엔지니어링의 가장 큰 차이는 시간, (규모)확장, 실전에서의 트레이드오프 이다. 소프트웨어 엔지니어링 프로젝트에서 엔지니어는 시간의 흐름과 언젠가 변경될 가능성에 더 신경 써야 한다. 만들어낼 소프트웨어 자체뿐 아니라, 제작하는 조직까지 양 측면 모두에서의 확장과 효율에 더 집중해야 한다. 소프트웨어 엔지니어링은 흐르는 시간 ...</p></div></div></a></div><div class="card"> <a href="/posts/02.%ED%8C%80%EC%9B%8C%ED%81%AC-%EC%9D%B4%EB%81%8C%EC%96%B4%EB%82%B4%EA%B8%B0/"><div class="card-body"> <em class="timeago small" data-ts="1666169603" > 2022-10-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>02. 팀워크 이끌어내기</h3><div class="text-muted small"><p> 이번 장의 핵심 주제는 소프트웨어 개발은 팀의 단합된 노력의 결실이라는 점이다. 그래서 엔지니어링팀이 성공하려면 겸손, 존중, 신뢰라는 핵심 원칙에 맞게 자신의 행동을 바로잡아야 한다. 2.1 내 코드를 숨기고 싶어요 사람들은 자신이 진행 중인 작업물을 다른 사람이 보고 판단하는 걸 두려워 한다. 이러한 불안감은 소프트웨어 개발에서의 더 큰 문제의 ...</p></div></div></a></div><div class="card"> <a href="/posts/03.%EC%A7%80%EC%8B%9D-%EA%B3%B5%EC%9C%A0/"><div class="card-body"> <em class="timeago small" data-ts="1666255028" > 2022-10-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>03. 지식 공유</h3><div class="text-muted small"><p> 조직에는 배움의 문화가 자리 잡혀 있어야 하고, 그러려면 사람들에게 모르는 걸 인정할 수 있도록 돕는 심리적 안전을 제공해야 한다. 3.1 배움을 가로막는 장애물 심리적 안전 부족 - 불이익이 두려워서 스스로 위험을 감수하거나 실수를 드러내기 꺼리는 환경 정보 섬 - 조직의 각 부서가 서로 소통하거나 자원을 공유하지 않아서 지식이 파편화(정...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/11.%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%9C%EC%9A%94/" class="btn btn-outline-primary" prompt="Older"><p>11. 테스트 개요</p></a> <a href="/posts/13.%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8C%80%EC%97%AD/" class="btn btn-outline-primary" prompt="Newer"><p>13. 테스트 대역</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
