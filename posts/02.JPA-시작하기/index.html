<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="JPA 시작하기" /><meta property="og:locale" content="en" /><meta name="description" content="01. 예제 프로젝트 02. 메이븐 프로젝트 생성 및 이클립스 임포트 03. 데이터베이스 생성 04. 모델 클래스와 매핑 설정 ```java @Entity //1) @Table(name=”user”) //2) public class User {" /><meta property="og:description" content="01. 예제 프로젝트 02. 메이븐 프로젝트 생성 및 이클립스 임포트 03. 데이터베이스 생성 04. 모델 클래스와 매핑 설정 ```java @Entity //1) @Table(name=”user”) //2) public class User {" /><link rel="canonical" href="https://limhyeonsu.github.io/posts/02.JPA-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/" /><meta property="og:url" content="https://limhyeonsu.github.io/posts/02.JPA-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/" /><meta property="og:site_name" content="Hyeonsu Lim" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-15T21:43:38+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JPA 시작하기" /><meta name="twitter:site" content="@imhyeon99494867" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-20T00:22:25+09:00","datePublished":"2022-12-15T21:43:38+09:00","description":"01. 예제 프로젝트 02. 메이븐 프로젝트 생성 및 이클립스 임포트 03. 데이터베이스 생성 04. 모델 클래스와 매핑 설정 ```java @Entity //1) @Table(name=”user”) //2) public class User {","headline":"JPA 시작하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://limhyeonsu.github.io/posts/02.JPA-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/"},"url":"https://limhyeonsu.github.io/posts/02.JPA-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/"}</script><title>2. JPA 시작하기 | Hyeonsu Lim</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hyeonsu Lim"><meta name="application-name" content="Hyeonsu Lim"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/profile_img.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hyeonsu Lim</a></div><div class="site-subtitle font-italic">Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Limhyeonsu" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/imhyeon99494867" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['gustn72096','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>2. JPA 시작하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>2. JPA 시작하기</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1671108218" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-12-15 </em> </span> <span> Updated <em class="timeago" data-ts="1674141745" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2023-01-20 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2717 words"> <em>15 min</em> read</span></div></div></div><div class="post-content"><h2 id="01-예제-프로젝트"><span class="mr-2">01. 예제 프로젝트</span><a href="#01-예제-프로젝트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h2 id="02-메이븐-프로젝트-생성-및-이클립스-임포트"><span class="mr-2">02. 메이븐 프로젝트 생성 및 이클립스 임포트</span><a href="#02-메이븐-프로젝트-생성-및-이클립스-임포트" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h2 id="03-데이터베이스-생성"><span class="mr-2">03. 데이터베이스 생성</span><a href="#03-데이터베이스-생성" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h2 id="04-모델-클래스와-매핑-설정"><span class="mr-2">04. 모델 클래스와 매핑 설정</span><a href="#04-모델-클래스와-매핑-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span> <span class="c1">//1)</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"user"</span><span class="o">)</span> <span class="c1">//2)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span> <span class="c1">//3)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span> <span class="c1">//4)</span>

    <span class="nd">@Temporal</span><span class="o">(</span><span class="nc">TemporalType</span><span class="o">.</span><span class="na">TIMESTAMP</span><span class="o">)</span>  <span class="c1">//5)</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"create_date"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">createDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createDate</span> <span class="o">=</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">getCreateDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createDate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>1) @Entity : JPA에서 엔티티는 DB 테이블과 매핑되는 기본 단위이다. 2) @Table : 클래스가 어떤 테이블과 매핑되는지 설정 name 속성을 이용해서 테이블 이름을 지정 3) @Id : DB에서의 PK 설정, JPA에서는 식별자라 한다. 4) name 필드 : name 필드의 경우 애노테이션이 없는데 이 경우에는 필드 이름과 동일한 이름의 테이블 컬럼에 매핑한다. 5) Date 타입을 매핑할 땐 @Timestamp 애노테이션을 사용한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>//JPA가 EntityManager를 이용해서 식별자가 madvirus@madvirus.net에 해당하는 User 객체를 찾는다.
User user = entityManager.find(User.class, "madvirus@madvirus.net");
</pre></table></code></div></div><p>JPA는 테이블과 매핑된 클래스의 객체를 생성할 때 인자가 없는 기본 생성자를 사용한다. 그래서 엔티티 클래스에 기본 생성자를 추가한다.</p><h2 id="05-jpa-설정"><span class="mr-2">05. JPA 설정</span><a href="#05-jpa-설정" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>JPA 설정 파일을 작성해야한다. src/main/resources/META-INF/persistence.xml 경로에 persistence.xml를 생성한다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>&lt;?xml version="1.0" encoding="utf-8" ?&gt;

&lt;persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
		http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
    version="2.1"&gt;

    &lt;!-- transaction-type 설정을 통해 JPA 트랜잭션 타입을 지정할 수 있다. (로컬 트랜잭션 or 글로벌 트랜잭션) --&gt;
    &lt;persistence-unit name="jpastart" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;class&gt;jpastart.reserve.model.User&lt;/class&gt;

        &lt;!-- 1) false로 설정시 &lt;class&gt;태그로 지정하지 않은 클래스는 관리 대상에 포함하지 않음 --&gt;
        &lt;exclude-unlisted-classes&gt;true&lt;/exclude-unlisted-classes&gt;

        &lt;properties&gt;
            &lt;!-- 2) 데이터베이스 연결 정보 설정 --&gt;
            &lt;property name="javax.persistence.jdbc.driver"
                value="com.mysql.jdbc.Driver" /&gt;
            &lt;property name="javax.persistence.jdbc.url"
                value="jdbc:mysql://localhost/jpastart?characterEncoding=utf8" /&gt;
            &lt;property name="javax.persistence.jdbc.user" value="jpauser" /&gt;
            &lt;property name="javax.persistence.jdbc.password"
                value="jpapass" /&gt;

            &lt;!-- 3) 하이버네이트 설정 --&gt;
            &lt;property name="hibernate.show_sql" value="true" /&gt;
            &lt;property name="hibernate.dialect"
                value="org.hibernate.dialect.MySQL5InnoDBDialect" /&gt;

            &lt;property name="hibernate.c3p0.min_size" value="5" /&gt;
            &lt;property name="hibernate.c3p0.max_size" value="20" /&gt;
            &lt;property name="hibernate.c3p0.timeout" value="500" /&gt;
            &lt;property name="hibernate.c3p0.idle_test_period"
                value="2000" /&gt;
        &lt;/properties&gt;

    &lt;/persistence-unit&gt;

&lt;/persistence&gt;
</pre></table></code></div></div><p>JPA는 영속 단위(persistence unit 별로 엔티티 클래스를 관리한다. 영속 단위는 JPA가 영속성을 관리할 단위로 영속 단위별로 매핑 대상, DB 연결 설정 등을 관리한다. 보통 한 개의 애플리케이션은 한 개의 영속 단위를 설정한다.</p><h3 id="51-db-종류와-dialect"><span class="mr-2">5.1 DB 종류와 Dialect</span><a href="#51-db-종류와-dialect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>hibernate.dialect 속성은 하이버네이트가 쿼리를 생성할 때 사용할 Dialect 종류를 지정한다. 속성값으로 사용할 DBMS에 맞는 클래스 이름을 지정한면 하이버네이트가 DB 종류에 맞는 쿼리를 생성한다.</p><h2 id="06-영속-컨텍스트와-영속-객체-개요"><span class="mr-2">06. 영속 컨텍스트와 영속 객체 개요</span><a href="#06-영속-컨텍스트와-영속-객체-개요" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>@Entity 애노테이션이 붙은 클래스를 JPA에서는 엔티티라고 부른다. 이 엔티티는 DB에 보관되는 대상으로 <code class="language-plaintext highlighter-rouge">JPA는 엔티티들을 영속성 컨텍스트로 관리</code>한다. 영속성 컨텍스트는 JPA가 관리하는 엔티티 객체 집합으로 영속 컨텍스트에 속한 엔티티 객체를 DB에 반영한다.</p><p><img data-src="/assets/img/posting_img/book/JPA%20프로그래밍%20입문/영속컨텍스트.jpeg" width="700px" data-proofer-ignore></p><p>보통 영속 컨텍스트는 세션 단위로 생긴다. 즉 세션 생성 시점에 영속 컨텍스트가 생성되고 세션 종료 시점에 컨텍스트가 사라진다. 응용 프로그램은 영속 컨텍스트에 직접 접근할 수 없기 때문에 <code class="language-plaintext highlighter-rouge">EntityManager를 통해서 영속 컨텍스트와 관련된 작업을 수행</code>한다. EntityManager를 통해서 영속 컨텍스트에 엔티티 객체를 추가하고, EntityManager를 통해서 영속 컨텍스트로부터 엔티티 객체를 구한다.</p><h2 id="07-간단한-예제-실행"><span class="mr-2">07. 간단한 예제 실행</span><a href="#07-간단한-예제-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddUserMain</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//persistence.xml 파일에 명시한 영속 단위 이름을 파라미터로 보내준다.</span>
        <span class="nc">EntityManagerFactory</span> <span class="n">emf</span> <span class="o">=</span> <span class="n">persistence</span><span class="o">.</span><span class="na">createEntityManagerFactory</span><span class="o">(</span><span class="s">"jpastart"</span><span class="o">);</span>
        <span class="c1">//EntityManager를 사용해서 DB 연동을 처리한다.</span>
        <span class="nc">EntityManager</span> <span class="n">entityManager</span> <span class="o">=</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="nc">EntityTransation</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//JPA는 트랜잭션 범위에서 DB를 변경을 처리하도록 제한하고 있기 때문에, 먼저 트랜잭션을 시작해야 새로운 데이터를 추가하거나 기존 데이터를 변경할 수 있다.</span>
            <span class="n">transaction</span><span class="o">.</span><span class="na">begin</span><span class="o">();</span>
            <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"user@user.com"</span><span class="o">,</span> <span class="s">"user"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
            <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>    <span class="c1">//영속 컨텍스트에 객체 추가</span>
            <span class="c1">//정상 실행하면 트랜잭션 커밋</span>
            <span class="n">transaction</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>       <span class="c1">//커밋하는 순간 실제 DB에 반영된다.</span>

        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="c1">//문제 발생하면 트랜잭션 롤백</span>
            <span class="n">transaction</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//필요한 작업이 끝나면 EntityManager를 종료한다.</span>
            <span class="n">entityManager</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">//애플리케이션 자체를 종료할 때는 EntityManagerFactory를 종료하여 커넥션 풀과 같은 자원을 반환받는다.</span>
        <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="08-entitymanagerf트actory-관련-보조-클래스"><span class="mr-2">08. EntityManagerF트actory 관련 보조 클래스</span><a href="#08-entitymanagerf트actory-관련-보조-클래스" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">//EntityManager를 쉽게 생성할 수 있도록 보조 클래스를 작성할 수 있다.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EMF</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">EntityManagerFactory</span> <span class="n">emf</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">emf</span> <span class="o">=</span> <span class="nc">Persistence</span><span class="o">.</span><span class="na">createEntityFactory</span><span class="o">(</span><span class="s">"jpastart"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">EntityManager</span> <span class="nf">createEntityManager</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">emf</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">emf</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddUserMain</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">EMF</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="no">EMF</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>

        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//jpa 프로그램 수행</span>


        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="no">EMF</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="09-콘솔을-사용한-사용자-관리-예제"><span class="mr-2">09. 콘솔을 사용한 사용자 관리 예제</span><a href="#09-콘솔을-사용한-사용자-관리-예제" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserMain</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">JoinService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JoinService</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">GetUserService</span> <span class="n">getUserService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GetUserService</span><span class="o">();</span>
    <span class="c1">//...</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">EMF</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>

        <span class="nc">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>

        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"명령어를 입력하세요."</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="nc">String</span><span class="o">[]</span> <span class="n">commends</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>

            <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"exit"</span><span class="o">))</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"종료합니다."</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"join"</span><span class="o">)){</span>
                <span class="n">handleJoinCommand</span><span class="o">(</span><span class="n">commands</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"view"</span><span class="o">)){</span>
                <span class="n">handleViewCommand</span><span class="o">(</span><span class="n">commands</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"list"</span><span class="o">)){</span>
              <span class="c1">//...</span>
            <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"changename"</span><span class="o">)){</span>
              <span class="c1">//...</span>
            <span class="o">}</span><span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">commends</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"withdraw"</span><span class="o">)){</span>
              <span class="c1">//...</span>
            <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"올바른 명령어를 입력하세요."</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"-----"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="no">EMF</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleJoinCommand</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">cmd</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"명령어가 올바르지 않습니다."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"사용법: join 이메일 이름"</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="k">try</span><span class="o">{</span>
        <span class="n">joinService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">cmd</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span> <span class="n">cmd</span><span class="o">[</span><span class="mi">2</span><span class="o">],</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"가입 요청을 처리했습니다."</span><span class="o">);</span>
      <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">DuplcateException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"이미 같은 이메일을 가진 사용자가 존재합니다."</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleViewCommand</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">cmd</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"명령어가 올바르지 않습니다."</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"사용법: view 이메일"</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">userOpt</span> <span class="o">=</span> <span class="n">getUserService</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">cmd</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
      <span class="k">if</span><span class="o">(</span><span class="n">userOpt</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userOpt</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"이름 : "</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"생성 : %tY-%&lt;tm-%&lt;td\n"</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getCreateDetail</span><span class="o">());</span>
      <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"존재하지 않습니다."</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//....</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="91-사용자-가입-기능-구현"><span class="mr-2">9.1 사용자 가입 기능 구현</span><a href="#91-사용자-가입-기능-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JoinService</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Join</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="no">EMF</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
        <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//em.find()는 식별자를 이용하여 엔티티 객체를 찾는다.</span>
            <span class="nc">User</span> <span class="n">found</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
            <span class="k">if</span><span class="o">(</span><span class="n">found</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">DuplicateEmailException</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
            <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
            <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="92-사용자-정보-조회-기능-구현--단일-사용자"><span class="mr-2">9.2 사용자 정보 조회 기능 구현 : 단일 사용자</span><a href="#92-사용자-정보-조회-기능-구현--단일-사용자" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetUserService</span><span class="o">{</span>
  <span class="c1">//getUser() 메서드는 트랜잭션 범위에서 실행하지 않는다. 수정 기능이 없고 단일 엔티티 객체를 조회하므로 트랜잭션이 필요없다.</span>
  <span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="no">EMF</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>

    <span class="k">try</span><span class="o">{</span>
      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
      <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
      <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="93-사용자-정보-변경-기능-구현"><span class="mr-2">9.3 사용자 정보 변경 기능 구현</span><a href="#93-사용자-정보-변경-기능-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>@Entity
@Table(name="user")
public class User {

    @Id
    private String email;
    private String name;

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name="create_date")
    private Date createDate;

    //....


    public void changeName(String newName) {
      this.name = newName;
    }
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>public class ChangeNameService{
  public void changeName(String email, String newName) {
    EntityManager em = EMF.createEntityManager();

    try{
      em.getTransaction().begin();
      User user = em.find(User.class, email);
      if(user == null)thorw new UserNotFoundException();

      //수정한 user 객체를 DB에 반영하는 코드가 없다.
      //JPA는 트랜잭션을 종료할 때 영속 컨텍스트에 존재하는 영속 객체의 값이 변경되었는지를 검사하여 값이 바뀐 경우 변경된 값을 DB에 반영한다.
      user.changeName(newName);
      em.getTransaction().commit();
    }catch(Exception e) {
      em.getTransaction().rollback();
      throw ex;
    }finally{
      em.close();
    }
  }
}
</pre></table></code></div></div><h3 id="94-사용자-정보-조회-기능-구현--목록"><span class="mr-2">9.4 사용자 정보 조회 기능 구현 : 목록</span><a href="#94-사용자-정보-조회-기능-구현--목록" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>public class GetUserListService{
  public List&lt;User&gt; getAllUsers() {
    EntityManager em = EMF.createEntityManager();
    try{
      em.getTransaction().begin();
      //JPQL을 실행하기 위한 TypedQuery를 생성 아래 쿼리에서 User는 user 테이블이 아닌 User 클래스를 의미한다.
      TypedQuery&lt;User&gt; query = em.createQuery("select u from User u order by u.name", User.class);
      List&lt;User&gt; result = query.getResultList();
      em.getTransaction().commit();
      return result;
    }catch(Exception ex) {
      em.getTransaction().rollback();
      throw ex;
    }finally{
      em.close();
    }
  }
}
</pre></table></code></div></div><p>JPA는 SQL과 유사한 JPQL을 제공한다.JPQL은 매핑 설정을 담은 클래스를 이용해서 쿼리를 작성한다.</p><h3 id="95-사용자-정보-삭제-기능-구현"><span class="mr-2">9.5 사용자 정보 삭제 기능 구현</span><a href="#95-사용자-정보-삭제-기능-구현" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WithdrawService</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">withdraw</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">EntityManager</span> <span class="n">em</span> <span class="o">=</span> <span class="no">EMF</span><span class="o">.</span><span class="na">createEntityManager</span><span class="o">();</span>
    <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">begin</span><span class="o">();</span>

    <span class="k">try</span><span class="o">{</span>
      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">email</span><span class="o">);</span>
      <span class="k">if</span><span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">UserNotFoundException</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">em</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">commit</span><span class="o">();</span>
    <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">em</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">().</span><span class="na">rollback</span><span class="o">();</span>
      <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
    <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
      <span class="n">em</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="10-정리"><span class="mr-2">10. 정리</span><a href="#10-정리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>JPA 프로바이더가 SQL 쿼리를 생성하기 때문에 개발자는 기본적인 추가, 조회, 삭제를 위한 SQL 쿼리를 작성하지 않아도 된다. persist() 메서드를 사용하면 자바 객체를 매핑된 테이블에 삽입하는 insert 쿼리를 실행한다. find() 메서드를 사용하면 테이블에서 데이터를 조회하는 select 쿼리를 살행하고 그 결과로부터 객체를 생성한다.</p><p>주요한 특징은 엔티티에 수정이 발생하면 이를 자동으로 DB에 반영해준다는 것이다. JPA는 객체의 변경내용을 추척하여 트랜잭션 종료시 알맞게 update 쿼리를 실행해서 변경된 값을 DB에 반영한다.</p><p>주의할 점으로는 높은 성능이 요구되는 SQL 쿼리가 필요한 기능은 JPA의 쿼리 생성 기능이 문제를 유발할 수 있다. 예) 대량 데이터를 배치로 처리, 복잡한 조회 쿼리가 필요할 때 등등..</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/book/'>BOOK</a>, <a href='/categories/jpa-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%9E%85%EB%AC%B8/'>JPA 프로그래밍 입문</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >jpa</a> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=2.+JPA+%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0+-+Hyeonsu+Lim&url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F02.JPA-%25EC%258B%259C%25EC%259E%2591%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=2.+JPA+%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0+-+Hyeonsu+Lim&u=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F02.JPA-%25EC%258B%259C%25EC%259E%2591%25ED%2595%2598%25EA%25B8%25B0%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Flimhyeonsu.github.io%2Fposts%2F02.JPA-%25EC%258B%259C%25EC%259E%2591%25ED%2595%2598%25EA%25B8%25B0%2F&text=2.+JPA+%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0+-+Hyeonsu+Lim" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div><script src="https://utteranc.es/client.js" repo="Limhyeonsu/Limhyeonsu.github.io" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async> </script></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/15.Top-N%EC%BF%BC%EB%A6%AC/">15. Top-N 쿼리</a><li><a href="/posts/09.%EB%A9%B4%EC%A0%91%EB%AC%B8%EC%A0%9C/">09. 면접문제</a><li><a href="/posts/14.%EB%B6%84%EC%84%9D%ED%95%A8%EC%88%98/">14. 분석함수</a><li><a href="/posts/07.%EA%B8%B0%EC%88%A0%EC%A0%81-%EB%AC%B8%EC%A0%9C/">07. 기술적 문제</a><li><a href="/posts/06.bigO/">06. big-O</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/03.%EC%97%94%ED%8B%B0%ED%8B%B0/"><div class="card-body"> <em class="timeago small" data-ts="1671352838" > 2022-12-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>3. 엔티티</h3><div class="text-muted small"><p> 01. 엔티티 클래스 JPA에서 엔티티는 영속성을 가진 객체로서 가장 중요한 타입이다. JPA의 엔티티는 DB 테이블에 보관할 대상이 된다. EntityManager를 사용해서 엔티티 단위로 저장하고 조회하고 삭제한다. JPA는 두 가지 방법으로 엔티티를 설정하는데 1)@Entity 애노테이션을 사용하는 방법 2)XML 매핑 설정을 사용하는 방법이 ...</p></div></div></a></div><div class="card"> <a href="/posts/04.%EB%B0%B8%EB%A5%98%EC%99%80-@Embeddable/"><div class="card-body"> <em class="timeago small" data-ts="1671631332" > 2022-12-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>4. 밸류와 @Embeddable</h3><div class="text-muted small"><p> 01. 밸류로 의미 더 드러내기 Hotel 클래스는 주소 자체를 의미하는 address 데이터를 갖고 있다. 그리고 Address 클래스는 zipcode, address1, address2를 데이터로 갖고 있어 따로 유추하지 않아도 주소가 우편번호, 주소1, 주소2로 구성된다는 것을 알 수 있다. Address 클래스 같은 타입을 value라고 ...</p></div></div></a></div><div class="card"> <a href="/posts/05.EntityManager,%EC%98%81%EC%86%8D%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8,%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98/"><div class="card-body"> <em class="timeago small" data-ts="1671880118" > 2022-12-24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5. EntityManager, 영속 컨텍스트, 트랜잭션</h3><div class="text-muted small"><p> 01. EntityManager와 영속 컨텍스트 1 2 3 4 5 6 7 8 9 10 11 12 13 14 EntityManager entityManager = emf.createEntityManager(); EntityTransaction transaction = entityManager.getTransaction(); try{ transact...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/9.%EC%A7%91%EA%B3%84%ED%95%A8%EC%88%98/" class="btn btn-outline-primary" prompt="Older"><p>9. 집계함수</p></a> <a href="/posts/03.%EC%97%94%ED%8B%B0%ED%8B%B0/" class="btn btn-outline-primary" prompt="Newer"><p>3. 엔티티</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/imhyeon99494867">Lim Hyeonsu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/sql/">sql</a> <a class="post-tag" href="/tags/software-engineering/">software_engineering</a> <a class="post-tag" href="/tags/jpa/">jpa</a> <a class="post-tag" href="/tags/computer/">computer</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/infra/">infra</a> <a class="post-tag" href="/tags/tdd/">tdd</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/bufferedreader/">bufferedreader</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
